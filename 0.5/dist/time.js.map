{"version":3,"file":"time.js","sources":["../src/polyfills.js","../src/app/global.js","../src/app/task/sequencer/sequenceGoto.js","../node_modules/fastdom/fastdom.js","../src/app/task/canvas/getSize.js","../src/app/task/canvas/adjust_canvas.js","../src/app/task/canvas/applyCanvasStyles.js","../node_modules/mithril-stream/stream.js","../node_modules/minno-css/css.js","../src/app/setup.js","../src/app/task/canvas/canvasSetup.js","../src/app/task/sequencer/createDB.js","../src/app/task/sequencer/preloader.js","../src/app/task/sequencer/buildUrl.js","../src/app/task/sequencer/scriptPreloader.js","../src/app/trial/input/bindings/mouseEvents.js","../src/app/trial/input/bindings/keypressed.js","../src/app/trial/input/bindings/timeout.js","../src/app/trial/input/bindings/simpleRandomize.js","../src/app/trial/input/binder.js","../src/app/trial/input/bindings/keyup.js","../src/app/trial/input/createListener.js","../src/app/trial/input/now.js","../src/app/trial/stimulus/getMedia.js","../src/app/trial/stimulus/setSize.js","../src/app/trial/stimulus/setPlace.js","../src/app/trial/stimulus/setupElement.js","../src/app/trial/stimulus/Stimulus.js","../src/app/trial/stimulus/stimulusCollection.js","../src/app/trial/interactions/getConditionFn.js","../src/app/trial/interactions/conditionsEvaluate.js","../src/app/trial/interactions/actionList.js","../src/app/trial/interactions/action.js","../src/app/trial/interactions/interactions.js","../src/app/trial/Trial.js","../src/app/trial/input/input.js","../src/app/task/logger/defaultLogMap.js","../src/app/playPhase.js","../src/app/task/logger/createLogStream.js","../src/app/task/sequencer/nextTrial.js","../src/index.js","../src/app/preloadPhase.js"],"sourcesContent":["if (!Date.now) Date.now = function() { return new Date().getTime(); };\n\n(function(w){\n\tvar perfNow;\n\tvar perfNowNames = ['now', 'webkitNow', 'msNow', 'mozNow'];\n\tif(!!w['performance']) for(var i = 0; i < perfNowNames.length; ++i)\n\t{\n\t\tvar n = perfNowNames[i];\n\t\tif(!!w['performance'][n])\n\t\t{\n\t\t\tperfNow = function(){return w['performance'][n]()};\n\t\t\tbreak;\n\t\t}\n\t}\n\tif(!perfNow)\n\t{\n\t\tperfNow = Date.now;\n\t}\n\tw.perfNow = perfNow;\n})(window);\n\nfunction log(){ console.log.apply(console, arguments); }\nif (!console.group) console.group = log;\nif (!console.groupCollapsed) console.groupCollapsed = log;\nif (!console.groupEnd) console.groupEnd = log;\nif (!console.table) console.table = log;\n\n\n(function() {\n    'use strict';\n\n    var vendors = ['webkit', 'moz'];\n    for (var i = 0; i < vendors.length && !window.requestAnimationFrame; ++i) {\n        var vp = vendors[i];\n        window.requestAnimationFrame = window[vp+'RequestAnimationFrame'];\n        window.cancelAnimationFrame = (window[vp+'CancelAnimationFrame']\n            || window[vp+'CancelRequestAnimationFrame']);\n    }\n    // iOS6 is buggy\n    if (/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent) || !window.requestAnimationFrame || !window.cancelAnimationFrame) {\n        var lastTime = 0;\n        window.requestAnimationFrame = function(callback) {\n            var now = Date.now();\n            var nextTime = Math.max(lastTime + 16, now);\n            return setTimeout(function() { callback(lastTime = nextTime); },\n                              nextTime - now);\n        };\n        window.cancelAnimationFrame = clearTimeout;\n    }\n}());\n\n// Promise polyfill from https://github.com/MithrilJS/mithril.js/blob/next/promise/promise.js \n\"use strict\"\n/** @constructor */\nvar PromisePolyfill = function(executor) {\n    if (!(this instanceof PromisePolyfill)) throw new Error(\"Promise must be called with `new`\")\n        if (typeof executor !== \"function\") throw new TypeError(\"executor must be a function\")\n\n            var self = this, resolvers = [], rejectors = [], resolveCurrent = handler(resolvers, true), rejectCurrent = handler(rejectors, false)\n            var instance = self._instance = {resolvers: resolvers, rejectors: rejectors}\n            var callAsync = typeof setImmediate === \"function\" ? setImmediate : setTimeout\n            function handler(list, shouldAbsorb) {\n                return function execute(value) {\n                    var then\n                    try {\n                        if (shouldAbsorb && value != null && (typeof value === \"object\" || typeof value === \"function\") && typeof (then = value.then) === \"function\") {\n                            if (value === self) throw new TypeError(\"Promise can't be resolved w/ itself\")\n                                executeOnce(then.bind(value))\n                        }\n                        else {\n                            callAsync(function() {\n                                if (!shouldAbsorb && list.length === 0) console.error(\"Possible unhandled promise rejection:\", value)\n                                    for (var i = 0; i < list.length; i++) list[i](value)\n                                        resolvers.length = 0, rejectors.length = 0\n                                instance.state = shouldAbsorb\n                                instance.retry = function() {execute(value)}\n                            })\n                        }\n                    }\n                    catch (e) {\n                        rejectCurrent(e)\n                    }\n                }\n            }\n            function executeOnce(then) {\n                var runs = 0\n                function run(fn) {\n                    return function(value) {\n                        if (runs++ > 0) return\n                        fn(value)\n                    }\n                }\n                var onerror = run(rejectCurrent)\n                try {then(run(resolveCurrent), onerror)} catch (e) {onerror(e)}\n            }\n\n            executeOnce(executor)\n}\nPromisePolyfill.prototype.then = function(onFulfilled, onRejection) {\n    var self = this, instance = self._instance\n    function handle(callback, list, next, state) {\n        list.push(function(value) {\n            if (typeof callback !== \"function\") next(value)\n                else try {resolveNext(callback(value))} catch (e) {if (rejectNext) rejectNext(e)}\n        })\n        if (typeof instance.retry === \"function\" && state === instance.state) instance.retry()\n    }\nvar resolveNext, rejectNext\nvar promise = new PromisePolyfill(function(resolve, reject) {resolveNext = resolve, rejectNext = reject})\nhandle(onFulfilled, instance.resolvers, resolveNext, true), handle(onRejection, instance.rejectors, rejectNext, false)\nreturn promise\n}\nPromisePolyfill.prototype.catch = function(onRejection) {\n    return this.then(null, onRejection)\n}\nPromisePolyfill.resolve = function(value) {\n    if (value instanceof PromisePolyfill) return value\n    return new PromisePolyfill(function(resolve) {resolve(value)})\n}\nPromisePolyfill.reject = function(value) {\n    return new PromisePolyfill(function(resolve, reject) {reject(value)})\n}\nPromisePolyfill.all = function(list) {\n    return new PromisePolyfill(function(resolve, reject) {\n        var total = list.length, count = 0, values = []\n        if (list.length === 0) resolve([])\n            else for (var i = 0; i < list.length; i++) {\n                (function(i) {\n                    function consume(value) {\n                        count++\n                            values[i] = value\n                            if (count === total) resolve(values)\n                    }\n                if (list[i] != null && (typeof list[i] === \"object\" || typeof list[i] === \"function\") && typeof list[i].then === \"function\") {\n                    list[i].then(consume, reject)\n                }\n                else consume(list[i])\n                })(i)\n            }\n    })\n}\nPromisePolyfill.race = function(list) {\n    return new PromisePolyfill(function(resolve, reject) {\n        for (var i = 0; i < list.length; i++) {\n            list[i].then(resolve, reject)\n        }\n    })\n}\n\nif (typeof window.Promise === \"undefined\") window.Promise = PromisePolyfill\n","export default global;\n\n// initiate piGloabl\nvar glob = window.piGlobal || (window.piGlobal = {});\n\nfunction global(){\n    return glob;\n}\n\n","/**\n * Go to a destination within the sequence (must be a property of a sequence)\n * @param  {String} target destination type\n * @param  {Object} properties destination options\n * @return {Object}        result element\n */\n\nimport _ from 'lodash';\nexport default go;\n\nfunction go(destination, properties, context){\n    var mixerSequence = this.mixerSequence;\n\n    switch (destination){\n        case 'nextWhere':\n            where('next', properties, context, mixerSequence);\n            break;\n        case 'previousWhere':\n            where('prev', properties, context, mixerSequence);\n            break;\n        case 'current':\n            // don't need to do anything...\n            break;\n        case 'first':\n            do {mixerSequence.prev(context);} while (mixerSequence.current(context));\n            break;\n        case 'last':\n            do {mixerSequence.next(context);} while (mixerSequence.current(context));\n            mixerSequence.prev();\n            break;\n        case 'end':\n            do {mixerSequence.next(context);} while (mixerSequence.current(context));\n            break;\n        case 'next' :\n            mixerSequence.next(context); // get the next trial, in case there are no more trials, returns undefined\n            break;\n        default:\n            throw new Error('Unknow destination \"' + destination + '\" for goto.');\n    }\n\n    return this;\n}\n\nfunction where(direction, properties, context, sequence){\n    var curr;\n\n    do {\n        sequence[direction]();\n        curr = sequence.current(context);\n    } while (curr && !_.iteratee(properties)(curr.data));\n}\n","!(function(win) {\n\n/**\n * FastDom\n *\n * Eliminates layout thrashing\n * by batching DOM read/write\n * interactions.\n *\n * @author Wilson Page <wilsonpage@me.com>\n * @author Kornel Lesinski <kornel.lesinski@ft.com>\n */\n\n'use strict';\n\n/**\n * Mini logger\n *\n * @return {Function}\n */\nvar debug = 0 ? console.log.bind(console, '[fastdom]') : function() {};\n\n/**\n * Normalized rAF\n *\n * @type {Function}\n */\nvar raf = win.requestAnimationFrame\n  || win.webkitRequestAnimationFrame\n  || win.mozRequestAnimationFrame\n  || win.msRequestAnimationFrame\n  || function(cb) { return setTimeout(cb, 16); };\n\n/**\n * Initialize a `FastDom`.\n *\n * @constructor\n */\nfunction FastDom() {\n  var self = this;\n  self.reads = [];\n  self.writes = [];\n  self.raf = raf.bind(win); // test hook\n  debug('initialized', self);\n}\n\nFastDom.prototype = {\n  constructor: FastDom,\n\n  /**\n   * Adds a job to the read batch and\n   * schedules a new frame if need be.\n   *\n   * @param  {Function} fn\n   * @param  {Object} ctx the context to be bound to `fn` (optional).\n   * @public\n   */\n  measure: function(fn, ctx) {\n    debug('measure');\n    var task = !ctx ? fn : fn.bind(ctx);\n    this.reads.push(task);\n    scheduleFlush(this);\n    return task;\n  },\n\n  /**\n   * Adds a job to the\n   * write batch and schedules\n   * a new frame if need be.\n   *\n   * @param  {Function} fn\n   * @param  {Object} ctx the context to be bound to `fn` (optional).\n   * @public\n   */\n  mutate: function(fn, ctx) {\n    debug('mutate');\n    var task = !ctx ? fn : fn.bind(ctx);\n    this.writes.push(task);\n    scheduleFlush(this);\n    return task;\n  },\n\n  /**\n   * Clears a scheduled 'read' or 'write' task.\n   *\n   * @param {Object} task\n   * @return {Boolean} success\n   * @public\n   */\n  clear: function(task) {\n    debug('clear', task);\n    return remove(this.reads, task) || remove(this.writes, task);\n  },\n\n  /**\n   * Extend this FastDom with some\n   * custom functionality.\n   *\n   * Because fastdom must *always* be a\n   * singleton, we're actually extending\n   * the fastdom instance. This means tasks\n   * scheduled by an extension still enter\n   * fastdom's global task queue.\n   *\n   * The 'super' instance can be accessed\n   * from `this.fastdom`.\n   *\n   * @example\n   *\n   * var myFastdom = fastdom.extend({\n   *   initialize: function() {\n   *     // runs on creation\n   *   },\n   *\n   *   // override a method\n   *   measure: function(fn) {\n   *     // do extra stuff ...\n   *\n   *     // then call the original\n   *     return this.fastdom.measure(fn);\n   *   },\n   *\n   *   ...\n   * });\n   *\n   * @param  {Object} props  properties to mixin\n   * @return {FastDom}\n   */\n  extend: function(props) {\n    debug('extend', props);\n    if (typeof props != 'object') throw new Error('expected object');\n\n    var child = Object.create(this);\n    mixin(child, props);\n    child.fastdom = this;\n\n    // run optional creation hook\n    if (child.initialize) child.initialize();\n\n    return child;\n  },\n\n  // override this with a function\n  // to prevent Errors in console\n  // when tasks throw\n  catch: null\n};\n\n/**\n * Schedules a new read/write\n * batch if one isn't pending.\n *\n * @private\n */\nfunction scheduleFlush(fastdom) {\n  if (!fastdom.scheduled) {\n    fastdom.scheduled = true;\n    fastdom.raf(flush.bind(null, fastdom));\n    debug('flush scheduled');\n  }\n}\n\n/**\n * Runs queued `read` and `write` tasks.\n *\n * Errors are caught and thrown by default.\n * If a `.catch` function has been defined\n * it is called instead.\n *\n * @private\n */\nfunction flush(fastdom) {\n  debug('flush');\n\n  var writes = fastdom.writes;\n  var reads = fastdom.reads;\n  var error;\n\n  try {\n    debug('flushing reads', reads.length);\n    runTasks(reads);\n    debug('flushing writes', writes.length);\n    runTasks(writes);\n  } catch (e) { error = e; }\n\n  fastdom.scheduled = false;\n\n  // If the batch errored we may still have tasks queued\n  if (reads.length || writes.length) scheduleFlush(fastdom);\n\n  if (error) {\n    debug('task errored', error.message);\n    if (fastdom.catch) fastdom.catch(error);\n    else throw error;\n  }\n}\n\n/**\n * We run this inside a try catch\n * so that if any jobs error, we\n * are able to recover and continue\n * to flush the batch until it's empty.\n *\n * @private\n */\nfunction runTasks(tasks) {\n  debug('run tasks');\n  var task; while (task = tasks.shift()) task();\n}\n\n/**\n * Remove an item from an Array.\n *\n * @param  {Array} array\n * @param  {*} item\n * @return {Boolean}\n */\nfunction remove(array, item) {\n  var index = array.indexOf(item);\n  return !!~index && !!array.splice(index, 1);\n}\n\n/**\n * Mixin own properties of source\n * object into the target.\n *\n * @param  {Object} target\n * @param  {Object} source\n */\nfunction mixin(target, source) {\n  for (var key in source) {\n    if (source.hasOwnProperty(key)) target[key] = source[key];\n  }\n}\n\n// There should never be more than\n// one instance of `FastDom` in an app\nvar exports = win.fastdom = (win.fastdom || new FastDom()); // jshint ignore:line\n\n// Expose to CJS & AMD\nif ((typeof define) == 'function') define(function() { return exports; });\nelse if ((typeof module) == 'object') module.exports = exports;\n\n})( typeof window !== 'undefined' ? window : this);\n","export default getSize;\n\n// helper function: returns sizes of element;\nfunction getSize(el){\n    var computedStyle = window.getComputedStyle(el);\n    return {\n        height    : parse(el.offsetHeight) - parse(computedStyle.borderTopWidth) - parse(computedStyle.borderBottomWidth),\n        width    : parse(el.offsetWidth) - parse(computedStyle.borderLeftWidth) - parse(computedStyle.borderRightWidth)\n    };\n}\n\nfunction parse(num){ return parseFloat(num, 10) || 0;}\n","/*\n * adjust canvas according to window size and settings\n * this module is built to be part of the main view\n */\n\nimport _ from 'lodash';\nimport fastdom from 'fastdom';\nimport getSize from './getSize';\n\nexport default adjust_canvas;\n\n// the function to be used by the main view\nfunction adjust_canvas(canvas, settings){\n\n    return _.throttle(eventListener, 16);\n\n    function eventListener(event){\n        // we put this in a time out because of a latency of orientation change on android devices\n        if (event.type == 'orientationchange') setTimeout(resize, 500);\n        else resize();\n    }\n\n    function resize(){\n        fastdom.measure(function(){\n            var targetSize = getTargetSize(settings, canvas);\n\n            // remove border width and top margin from calculated width (can't depend on cool box styles yet...)\n            // we compute only margin-top because of a difference calculating margins between chrome + IE and firefox + mobile\n            var computedStyle = window.getComputedStyle(canvas);\n            targetSize.height -= parse(computedStyle.borderTopWidth) + parse(computedStyle.borderBottomWidth) + parse(computedStyle.marginTop);\n            targetSize.width -= parse(computedStyle.borderLeftWidth) + parse(computedStyle.borderRightWidth);\n\n            fastdom.mutate(function(){\n                // reset canvas size\n                canvas.style.width = targetSize.width + 'px';\n                canvas.style.height = targetSize.height + 'px';\n                canvas.style.fontSize = targetSize.height*(settings.textSize || 3)/100 + 'px';\n\n                // scroll to top of window (hides some of the mess on the top of mobile devices)\n                window.scrollTo(0, 1);\n            });\n        });\n    }\n}\n\nfunction getProportions(proportions){\n    if (!_.isPlainObject(proportions)) return proportions || 0.8; // by default proportions are 0.8\n    if ([proportions.height, proportions.width].every(_.isFinite)) return proportions.height/proportions.width; \n    throw new Error('The canvas proportions object`s height and a width properties must be numeric');\n}\n\nfunction getTargetSize(settings, canvas){\n    // calculate proportions (as height/width)\n    var proportions = getProportions(settings.proportions);\n\n    // static canvas size\n    // ------------------\n    if (settings.width) return {\n        width: settings.width,\n        height: settings.width*proportions\n    };\n\n    // dynamic canvas size\n    // -------------------\n\n    var docElement = window.document.documentElement; // used to get client view size\n\n    var maxHeight = docElement.clientHeight;\n    var maxWidth = Math.min(settings.maxWidth || Infinity, docElement.clientWidth, getSize(canvas.parentNode).width);\n\n    // calculate the correct size for this screen size\n    if (maxHeight > proportions * maxWidth) return { height: maxWidth*proportions, width: maxWidth };\n    else return { height: maxHeight, width: maxHeight/proportions};\n}\n\nfunction parse(num){ return parseFloat(num, 10) || 0;}\n","/**\n *\n * This whole module taken from piManager\n *\n */\n\nimport _ from 'lodash';\nexport default canvasContructor;\n\n/**\n * Takes a map of css rules and applies them.\n * Returns a function that returns the page to its former condition.\n *\n * The rule map is an object of ruleName -> ruleObject.\n *\n * var ruleObject = {\n * \telement : wrapped element to affect\n * \tproperty: css property to modify\n * }\n *\n * @param  {Object} map      A hash of rules.\n * @param  {Object} settings A hash of ruleName -> value\n * @return {Function}        A function that undoes all the previous changes\n */\nfunction canvasContructor(map, settings){\n    var offArr;\n\n    if (!_.isPlainObject(map)) throw new Error('canvas(map): You must set a rule map for canvas to work properly');\n\n    // if settings is undefined return a function that doesn't do anything\n    // just so we don't need to make sure that the user modifies the canvas\n    if (_.isUndefined(settings)) return _.noop;\n    if (!_.isPlainObject(settings)) throw new Error('canvas(settings): canvas settings must be an object');\n\n    // create an array of off functions to undo any changes by this action\n    offArr = _.map(settings, function(value,key){\n        var rule = map[key];\n        if (rule) return on(rule.element, rule.property, value);\n        throw new Error('canvas('+ key +'): unknow key in canvas object.');\n    });\n\n    return function off(){\n        _.forEach(offArr, function(fn){fn.call();});\n    };\n}\n\nfunction on(el, property, value){\n    var old = el.style[property]; // save old value\n    el.style[property] = value; // set new value\n    return function(){el.style[property] = old;};  // create off function\n}\n\n","/* eslint-disable */\r\n;(function() {\r\n\"use strict\"\r\n/* eslint-enable */\r\n\r\nvar guid = 0, HALT = {}\r\nfunction createStream() {\r\n\tfunction stream() {\r\n\t\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\r\n\t\treturn stream._state.value\r\n\t}\r\n\tinitStream(stream)\r\n\r\n\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\r\n\r\n\treturn stream\r\n}\r\nfunction initStream(stream) {\r\n\tstream.constructor = createStream\r\n\tstream._state = {id: guid++, value: undefined, state: 0, derive: undefined, recover: undefined, deps: {}, parents: [], endStream: undefined, unregister: undefined}\r\n\tstream.map = stream[\"fantasy-land/map\"] = map, stream[\"fantasy-land/ap\"] = ap, stream[\"fantasy-land/of\"] = createStream\r\n\tstream.valueOf = valueOf, stream.toJSON = toJSON, stream.toString = valueOf\r\n\r\n\tObject.defineProperties(stream, {\r\n\t\tend: {get: function() {\r\n\t\t\tif (!stream._state.endStream) {\r\n\t\t\t\tvar endStream = createStream()\r\n\t\t\t\tendStream.map(function(value) {\r\n\t\t\t\t\tif (value === true) {\r\n\t\t\t\t\t\tunregisterStream(stream)\r\n\t\t\t\t\t\tendStream._state.unregister = function(){unregisterStream(endStream)}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn value\r\n\t\t\t\t})\r\n\t\t\t\tstream._state.endStream = endStream\r\n\t\t\t}\r\n\t\t\treturn stream._state.endStream\r\n\t\t}}\r\n\t})\r\n}\r\nfunction updateStream(stream, value) {\r\n\tupdateState(stream, value)\r\n\tfor (var id in stream._state.deps) updateDependency(stream._state.deps[id], false)\r\n\tif (stream._state.unregister != null) stream._state.unregister()\r\n\tfinalize(stream)\r\n}\r\nfunction updateState(stream, value) {\r\n\tstream._state.value = value\r\n\tstream._state.changed = true\r\n\tif (stream._state.state !== 2) stream._state.state = 1\r\n}\r\nfunction updateDependency(stream, mustSync) {\r\n\tvar state = stream._state, parents = state.parents\r\n\tif (parents.length > 0 && parents.every(active) && (mustSync || parents.some(changed))) {\r\n\t\tvar value = stream._state.derive()\r\n\t\tif (value === HALT) return false\r\n\t\tupdateState(stream, value)\r\n\t}\r\n}\r\nfunction finalize(stream) {\r\n\tstream._state.changed = false\r\n\tfor (var id in stream._state.deps) stream._state.deps[id]._state.changed = false\r\n}\r\n\r\nfunction combine(fn, streams) {\r\n\tif (!streams.every(valid)) throw new Error(\"Ensure that each item passed to stream.combine/stream.merge is a stream\")\r\n\treturn initDependency(createStream(), streams, function() {\r\n\t\treturn fn.apply(this, streams.concat([streams.filter(changed)]))\r\n\t})\r\n}\r\n\r\nfunction initDependency(dep, streams, derive) {\r\n\tvar state = dep._state\r\n\tstate.derive = derive\r\n\tstate.parents = streams.filter(notEnded)\r\n\r\n\tregisterDependency(dep, state.parents)\r\n\tupdateDependency(dep, true)\r\n\r\n\treturn dep\r\n}\r\nfunction registerDependency(stream, parents) {\r\n\tfor (var i = 0; i < parents.length; i++) {\r\n\t\tparents[i]._state.deps[stream._state.id] = stream\r\n\t\tregisterDependency(stream, parents[i]._state.parents)\r\n\t}\r\n}\r\nfunction unregisterStream(stream) {\r\n\tfor (var i = 0; i < stream._state.parents.length; i++) {\r\n\t\tvar parent = stream._state.parents[i]\r\n\t\tdelete parent._state.deps[stream._state.id]\r\n\t}\r\n\tfor (var id in stream._state.deps) {\r\n\t\tvar dependent = stream._state.deps[id]\r\n\t\tvar index = dependent._state.parents.indexOf(stream)\r\n\t\tif (index > -1) dependent._state.parents.splice(index, 1)\r\n\t}\r\n\tstream._state.state = 2 //ended\r\n\tstream._state.deps = {}\r\n}\r\n\r\nfunction map(fn) {return combine(function(stream) {return fn(stream())}, [this])}\r\nfunction ap(stream) {return combine(function(s1, s2) {return s1()(s2())}, [stream, this])}\r\nfunction valueOf() {return this._state.value}\r\nfunction toJSON() {return this._state.value != null && typeof this._state.value.toJSON === \"function\" ? this._state.value.toJSON() : this._state.value}\r\n\r\nfunction valid(stream) {return stream._state }\r\nfunction active(stream) {return stream._state.state === 1}\r\nfunction changed(stream) {return stream._state.changed}\r\nfunction notEnded(stream) {return stream._state.state !== 2}\r\n\r\nfunction merge(streams) {\r\n\treturn combine(function() {\r\n\t\treturn streams.map(function(s) {return s()})\r\n\t}, streams)\r\n}\r\n\r\nfunction scan(reducer, seed, stream) {\r\n\tvar newStream = combine(function (s) {\r\n\t\treturn seed = reducer(seed, s._state.value)\r\n\t}, [stream])\r\n\r\n\tif (newStream._state.state === 0) newStream(seed)\r\n\r\n\treturn newStream\r\n}\r\n\r\nfunction scanMerge(tuples, seed) {\r\n\tvar streams = tuples.map(function(tuple) {\r\n\t\tvar stream = tuple[0]\r\n\t\tif (stream._state.state === 0) stream(undefined)\r\n\t\treturn stream\r\n\t})\r\n\r\n\tvar newStream = combine(function() {\r\n\t\tvar changed = arguments[arguments.length - 1]\r\n\r\n\t\tstreams.forEach(function(stream, idx) {\r\n\t\t\tif (changed.indexOf(stream) > -1) {\r\n\t\t\t\tseed = tuples[idx][1](seed, stream._state.value)\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\treturn seed\r\n\t}, streams)\r\n\r\n\treturn newStream\r\n}\r\n\r\ncreateStream[\"fantasy-land/of\"] = createStream\r\ncreateStream.merge = merge\r\ncreateStream.combine = combine\r\ncreateStream.scan = scan\r\ncreateStream.scanMerge = scanMerge\r\ncreateStream.HALT = HALT\r\n\r\nif (typeof module !== \"undefined\") module[\"exports\"] = createStream\r\nelse if (typeof window.m === \"function\" && !(\"stream\" in window.m)) window.m.stream = createStream\r\nelse window.m = {stream : createStream}\r\n\r\n}());\r\n","module.exports = css;\n\n/**\n * @arg el DOMElement any dom element\n * @arg obj Object a hash of styleName:value, where the style name may be either css-style or jsStyle (camelCase)\n * @returns void\n *\n * The function applies the styles set in obj to the el\n **/\n\nfunction css(el, obj){\n    var style = el.style;\n\n    if (!obj) return;\n\n    for (var key in obj) style[camelCase(key)] = obj[key];\n\n    function camelCase(str){ \n        return  str.replace(/-([a-z])/g, function (g) { return g[1].toUpperCase(); }); \n    }\n}\n","import _ from 'lodash';\nimport global from './global';\nimport createDB from './task/sequencer/createDB';\nimport canvasSetup from './task/canvas/canvasSetup';\n\nexport default setup;\n\nfunction setup(canvas, script){\n    var $resize = canvasSetup(canvas, _.get(script, 'settings.canvas', {}));\n    var db = createDB(script);\n    setupVars(script);\n\n    return {\n        db:db, \n        $resize:$resize,\n        canvas: canvas,\n        script: script,\n        settings: script.settings || {}\n    };\n}\n\nfunction setupVars(script){\n    // init global\n    var glob = global(global());\n    var name = script.name || 'anonymous minno-time';\n    var current = script.current ? script.current : {};\n\n    current.logs || (current.logs = []); // init logs object\n    glob[name] = glob.current = current; // create local namespace\n}\n","import _ from 'lodash';\nimport adjustCanvas from './adjust_canvas';\nimport applyCanvasStyles from './applyCanvasStyles';\nimport stream from 'mithril-stream';\nimport css from 'minno-css';\n\nexport default setupCanvas;\n\nfunction setupCanvas(canvas, canvasSettings){\n    canvasSettings || (canvasSettings = {});\n    var $resize = stream();\n\n    if (!_.isElement(canvas)) throw new Error('Minno-time: canvas is not a DOM element');\n\n    canvas.classList.add('minno-canvas');\n\n    // apply canvas styles\n    var map = {\n        background \t\t\t: {element: document.body, property: 'backgroundColor'},\n        canvasBackground\t: {element: canvas, property:'backgroundColor'},\n        borderColor\t\t\t: {element: canvas, property:'borderColor'},\n        borderWidth\t\t\t: {element: canvas, property:'borderWidth'}\n    };\n\n    var off = applyCanvasStyles(map, _.pick(canvasSettings,['background','canvasBackground','borderColor','borderWidth']));\n\n    canvasSettings.css && css(canvas, canvasSettings.css);\n\n    // setup canvas resize\n    $resize.map(adjustCanvas(canvas, canvasSettings));\n    $resize({});\n\n    window.addEventListener('orientationchange', $resize);\n    window.addEventListener('resize', $resize);\n\n    $resize.end\n        .map(function(){canvas.classList.remove('minno-canvas');})\n        .map(function removeListeners(){\n            window.removeEventListener('orientationchange',$resize);\n            window.removeEventListener('resize', $resize);\n        })\n        .map(off);\n\n\n\n    return $resize;\n\n}\n","/*\n * this file is resposible for taking the experiment script (json) and parsing it\n */\n\n// load dependancies\nimport _ from 'lodash';\nimport Database from 'minno-sequencer';\nimport go from './sequenceGoto';\n\nexport default createDB;\n\nfunction createDB(script){\n    var db = new Database();\n    db.createColl('trial');\n    db.createColl('stimulus');\n    db.createColl('media');\n\n    db.add('trial', script.trialSets || []);\n    db.add('stimulus', script.stimulusSets || []);\n    db.add('media', script.mediaSets || []);\n\n    if (!_.isArray(script.sequence)) throw new Error('You must set a sequence array.');\n\n    var sequence = db.sequence('trial', script.sequence);\n    sequence.go = go; // see sequence/goto.js to understand why we are doing this\n    db.currentSequence = sequence;\n    return db;\n}\n","\n/*\n * media preloader\n * TODO: turn into factory, possibly make progress into a stream.\n */\nimport _ from 'lodash';\nexport default loader;\n\nvar srcStack = [];\t\t\t\t// an array holding all our sources\nvar defStack = [];\t\t\t\t// an array holding all the deferreds\nvar stackDone = 0;\t\t\t\t// the number of sources we have completed downloading\nvar images = {};\nvar getText = _.memoize(getXhr);\n\nvar loader = {\n    // loads a single source\n    load: load,\n\n    all: function(){\n        return Promise.all(defStack);\n    },\n\n    progress: function(){\n        return defStack.length ? stackDone/defStack.length : 1;\n    }\n};\n\n// load a single source\nfunction load(src, type){\n    // the source was already loaded\n    if (srcStack.indexOf(src) !== -1) return false;\n\n    // if we haven't loaded this yet\n    var promise = type == 'template' ? getText(src) : getImage(src);\n\n    promise\n        .then(function(){stackDone++;})\n        .then(function(){\n            loader.onload && loader.onload(src);\n        })\n        .catch(function(e){\n            loader.onerror && loader.onerror(e, src);\n        });\n\n    // keep defered and source for later.\n    defStack.push(promise);\n    srcStack.push(src);\n\n    return promise;\n}\n\nfunction getImage(url){\n    return  new Promise(function(resolve, reject){\n        var el = document.createElement('img');\n        el.onload = function(){resolve(el);};\n        el.onerror = function(){reject(new Error('Image not found: ' + url ));};\n        el.src = url;\n        images[url] = el;\n    });\n}\n\nfunction getXhr(url){\n    return new Promise(function(resolve, reject){\n        var request = new XMLHttpRequest();\n        request.open('GET',url, true);\n        request.onreadystatechange = function() {\n            if (this.readyState === 4) {\n                if (this.status >= 200 && this.status < 400) resolve(this.responseText);\n                else reject(new Error('Template not found:' + url));\n            }\n        };\n        request.send();\n    });\n}\n","/*\n * build the url for this src (add the generic baseUrl)\n */\n\nimport _ from 'lodash';\n\n/**\n * @param baseUrl {String|Object} the base url to prepend\n * @param url {String} the url we are dealing with\n * @param type {String} the type of resource we are dealing with (image or tempmlate) in case we have multiple base urls\n *\n * @returns String built url\n **/\nexport default function buildUrl(baseUrl, url, type){\n    // it this is a dataUrl type of image, we don't need to append the baseurl\n    if (type == 'image' && /^data:image/.test(url)) return url;\n\n    // the base url setting may be either a string, or an object with the type as a field\n    if (_.isObject(baseUrl)) baseUrl = baseUrl[type];\n\n    // make sure base url is set, and add trailing slash if needed\n    if (!baseUrl) baseUrl = '';\n    else if (baseUrl[baseUrl.length-1] != '/') baseUrl += '/';\n\n    return baseUrl + url;\n}\n","/*\n * gets all media that needs preloading and preloads it\n */\n\nimport _ from 'lodash';\nimport preloader from './preloader';\nimport buildUrl from './buildUrl';\n\nexport default preloadScript;\n\nfunction preloadScript(script, baseUrl){\n    getScriptMedia(script).forEach(loadMedia);\n    return preloader;\n\n    function loadMedia(media){\n        if (!_.isUndefined(media.image)) preloader.load(buildUrl(baseUrl, media.image, 'image'),'image');\n        if (!_.isUndefined(media.template)) preloader.load(buildUrl(baseUrl, media.template,'template'),'template');\n    }\n}\n\n/**\n * Iterates over a script and gathers all media\n **/\nexport function getScriptMedia(script){\n    var mediaSets = script.mediaSets;\n    var stimulusSets = _.map(script.stimulusSets, getStimMedia);\n    var trialSets = _.map(script.trialSets, getTrialMedia);\n    var sequence = _.filter(script.sequence,notMixer).map(getTrialMedia);\n\n    return _.flattenDeep([mediaSets, stimulusSets, trialSets, sequence]).filter(notUndefined);\n} \n\nfunction getTrialMedia(trial){\n    return [\n        _.map(trial.input, function(input){ return input.element; }),\n        _.map(trial.stimuli, getStimMedia),\n        _.map(trial.layout, getStimMedia)\n    ];\n}\n\nfunction getStimMedia(stim){ return stim.media; }\nfunction notMixer(trial){ return !trial.mixer; }\nfunction notUndefined(val){ return !_.isUndefined(val); }\n","import css from 'minno-css';\nimport fastdom from 'fastdom';\nimport stream from 'mithril-stream';\n\nexport default mouseEvents;\n\nfunction mouseEvents(eventName,inputObj, canvas){\n    var $listener = stream();\n    var element = inputObj.element;\n\n    if (element){\n        css(element, inputObj.css);\n        fastdom.mutate(function(){\n            canvas.appendChild(element);\n        });\n    }\n\n    canvas.addEventListener(eventName, clickListener);\n\n    $listener.end.map(removeClickListener);\n    return $listener;\n\n    function clickListener(e){\n        var target = e.target;\n        if (element && target === element) return $listener(e);\n        if (!element && target.getAttribute('data-handle') === inputObj.stimHandle) return $listener(e);\n        return;\n    }\n\n    function removeClickListener(){\n        if (element) canvas.removeChild(element);\n        canvas.removeEventListener(eventName, $listener);\n    }\n}\n","/*\n* key pressed listener\n* reqires key\n*\n* key can be either charCode or string.\n* or an array of charCode/strings.\n*/\n\n// we monitor all key up events so that we trigger only once per key down\nimport stream from 'mithril-stream';\nexport default keypressed;\n\nvar keyDownArr = [];\n\ndocument.addEventListener('keyup',function(e){ keyDownArr[e.which] = false; });// unset flag to prevent multi pressing of a key \n\nfunction keypressed(inputObj){\n    var $listener = stream();\n\n    // make sure key is an array\n    var keys = Array.isArray(inputObj.key) ? inputObj.key : [inputObj.key];\n\n    // map keys to keyCodes\n    var target = keys.map(function(value){ \n        return typeof value == 'string' ? value.toUpperCase().charCodeAt(0) : value; \n    });\n\n    document.addEventListener('keydown', keypressListener);\n\n    $listener.end.map(removeKeypressListener);\n    return $listener;\n\n    function keypressListener(e){\n        if (keyDownArr[e.which] || (target.indexOf(e.which) === -1)) return;\n        e.preventDefault(); // prevent FF from wasting about 10ms in browser-content.js (and fast search)\n        keyDownArr[e.which] = true; // set flag to prevent multi pressing of a key\n        $listener(e);\n    }\n\n    function removeKeypressListener(){\n        document.removeEventListener('keydown', keypressListener);\n    }\n}\n","import randomize from './simpleRandomize';\nimport stream from 'mithril-stream';\n\nexport default timeout;\n\nfunction timeout(inputObj){\n    var $listener = stream();\n    var timeoutID;\n    var duration = randomize(inputObj.duration) || 0;\n\n    $listener.end.map(cancel);\n\n    if (duration) setTimeout($listener.bind(null, {}), duration);\n    else $listener({}); // listener is already registered with $events so this should be immidiate\n\n    return $listener;\n\n    function cancel(){\n        clearTimeout(timeoutID);\n    }\n}\n","/**\n *\tTakes a properties objects and returns the result of a randomization:\n *\tIf it is an array - pick a random member\n *\tIf it is an object pick from within a range\n *\tIf it is a function return its result using the context\n *\tOtherwise simply return the properties\n */\nimport _ from 'lodash';\n\nexport default simpleRandomize;\n\nfunction simpleRandomize(properties, context){\n\n    if (_.isArray(properties)) {\n        var index = Math.floor(Math.random()*properties.length);\n        return properties[index];\n    }\n\n    if (_.isFunction(properties)) {\n        return properties.call(context);\n    }\n\n    // this must be after the test for arrays and functions, because they are considered objects too\n    if (_.isPlainObject(properties)) {\n        if (!_.isNumber(properties.min) || !_.isNumber(properties.max) || properties.min > properties.max) {\n            throw new Error('randomization objects need both a max and a minimum property, also max has to be larger than min');\n        }\n        return properties.min + (properties.max - properties.min) * Math.random();\n    }\n\n    // if this is not a randomization object simply return\n    return properties;\n}\n\n","\nimport _ from 'lodash';\nimport mouseEvents from './bindings/mouseEvents';\nimport keypressed from './bindings/keypressed';\nimport keyup from './bindings/keyup';\nimport timeout from './bindings/timeout';\nimport css from 'minno-css';\n\nexport default inputBinder;\n\n/**\n * The input binder is a hash of default input types\n * It returns a stream of events\n **/\nfunction inputBinder(inputObj, canvas){\n    var on = inputObj.on; // what type of binding is this?\n\n    switch (on){\n\n        case 'keypressed'\t: return keypressed(inputObj);\n\n        case 'keyup'\t\t: return keyup(inputObj);\n\n        case 'click'\t\t:\n        case 'mousedown'    :\n            return mouseEvents('mousedown', inputObj, canvas);\n\n        case 'mouseup'\t    : return mouseEvents('mouseup', inputObj, canvas);\n\n        case 'mouseenter'\t: return mouseEvents('mouseenter', inputObj, canvas);\n\n        case 'mouseleave'\t: return mouseEvents('mouseleave', inputObj, canvas);\n\n        case 'timeout'\t\t: return timeout(inputObj);\n\n        /*\n         * Shortcuts\n         */\n\n        case 'enter'\t: return keypressed(_.assign({key:13},inputObj));\n\n        case 'space'\t: return keypressed(_.assign({key:32},inputObj));\n\n        case 'esc'\t    : return keypressed(_.assign({key:27},inputObj));\n\n        case 'leftTouch'\t:\n            inputObj.element = createElement(inputObj.css, {\n                position: 'absolute',\n                left: 0,\n                width: '30%',\n                height: '100%',\n                background: '#00FF00',\n                opacity: 0.3\n            });\n\n            return mouseEvents('mousedown', inputObj, canvas);\n\n        case 'rightTouch'\t:\n            inputObj.element = createElement(inputObj.css, {\n                position: 'absolute',\n                right: 0,\n                width: '30%',\n                height: '100%',\n                background: '#00FF00',\n                opacity: 0.3\n            });\n\n            return mouseEvents('mousedown', inputObj, canvas);\n\n        case 'topTouch'\t:\n            inputObj.element = createElement(inputObj.css, {\n                position: 'absolute',\n                top: 0,\n                width: '100%',\n                height: '30%',\n                background: '#00FF00',\n                opacity: 0.3\n            });\n\n            return mouseEvents('mousedown', inputObj, canvas);\n\n        case 'bottomTouch'\t:\n            inputObj.element = createElement(inputObj.css, {\n                position: 'absolute',\n                bottom: 0,\n                width: '100%',\n                height: '30%',\n                background: '#00FF00',\n                opacity: 0.3\n            });\n\n            return mouseEvents('mousedown', inputObj, canvas);\n\n        default:\n            throw new Error('You have an input element with an unrecognized \"on\" property: ' + on);\n\n    }\n\n\n    function createElement(css2, css1){\n        var el = document.createElement('div');\n        css(el, css1);\n        css(el, css2);\n        return el;\n    }\n}\n","import stream from 'mithril-stream';\nexport default keyup; \n\nfunction keyup(inputObj){\n    var $listener = stream();\n    // make sure key is array\n    var keys = Array.isArray(inputObj.key) ? inputObj.key : [inputObj.key];\n\n    // map keys to keyCodes\n    var target = keys.map(function(value){ \n        return typeof value == 'string' ? value.toUpperCase().charCodeAt(0) : value; \n    });\n\n    document.addEventListener('keyup', keypressListener);\n\n    $listener.end.map(removeKeypressListener);\n    return $listener;\n\n    function keypressListener(e){\n        if (target.indexOf(e.which) === -1) return;\n        e.preventDefault();\n        return $listener(e);\n    }\n\n    function removeKeypressListener(){\n        document.removeEventListener('keyup', $listener);\n    }\n}\n","import binder from './binder';\nimport stream from 'mithril-stream';\nimport _ from 'lodash';\n\nexport default createListener;\n\nfunction createListener(inputObj,canvas){\n    var $listener = getListener(inputObj, canvas);\n\n    if (!isStream($listener)) throw new Error('Input functions must return valid streams: ' + logObj(inputObj));\n    if ('handle' in inputObj) $listener.handle = inputObj.handle;\n\n    return $listener;\n}\n\nfunction getListener(inputObj, canvas){\n    var $listener;\n\n    if (_.isFunction(inputObj)) return inputObj(inputObj, canvas, stream);\n\n    if (_.isPlainObject(inputObj)) {\n        if (_.isString(inputObj.on)) return binder(inputObj,canvas,stream);\n\n        if (_.isFunction(inputObj.on )) $listener = inputObj.on(inputObj,canvas,stream);\n        if (_.isFunction(inputObj.off)) $listener.end.map(inputObj.off);\n    }\n        \n    throw new Error('Input must only contain objects and functions, do you have an undefined value?');\n}\n\nfunction logObj(obj){\n    return _.isFunction(obj) ? obj.toString() : JSON.stringify(obj);\n}\n\n\nfunction isStream(stream) {return stream._state; }\n","export default window.performance.now\n    ? window.performance.now.bind(window.performance)\n\n    // We aren't using the absoulte time anywhere so we can use raw Date.now as a replacement\n    // if we're not on IE9\n    : Date.now.bind(Date);\n","import _ from 'lodash';\nexport default getMedia;\n\nfunction getMedia(media){\n    // all templateing is done within the inflate trial function and the sequencer\n    var template = media.html || media.inlineTemplate || media.template; // give inline template precedence over template, because tempaltes are loaded into inlinetemplate\n    var el;\n\n    if (_.isFunction(media)) return customMedia(media);\n\n    if (isWord(media)) media = {word:media};\n\n    if (isWord(media.word)) {\n        el = document.createElement('div');\n        el.textContent = media.word;\n        return Promise.resolve(el);\n    }\n\n    if (template) { // html | template | inlineTemplate\n        el = document.createElement('div');\n        el.innerHTML = template;\n        return Promise.resolve(el);\n    } \n\n    // at this time, we count on the preloader to throw for errors\n    // the reject option isn't really being used here...\n    if (media.$image) return new Promise(function(resolve, reject){\n        el = document.createElement('img');\n        el.onload = function(){resolve(el);};\n        el.onerror = function(){reject(new Error('Image not found: ' + el.src ));};\n        el.src = media.$image;\n    });\n\n    if (media.jquery) return Promise.reject(new Error('Jquery is no longer supported in minno-time'));\n\n    return Promise.reject(new Error('Unrecognized media type')); // this is not a supported html type\n}\n\nfunction isWord(val){ return _.isString(val) || _.isNumber(val); }\n\nfunction customMedia(media){\n    var promise = media();\n    if (!isThenable(promise)) return Promise.reject(new Error('Custom media must return a promise'));\n    return promise.then(forceElement);\n\n    function isThenable(p){ return p && _.isFunction(p.then); }\n    function forceElement(el){ return _.isElement(el) ? el : Promise.reject('Custom media must resolve with an element');}\n}\n","import _ from 'lodash';\nexport default setSize;\n\nfunction setSize(el,stimulus){\n    var style = el.style;\n    var size = stimulus.size || {};\n\n    if (size.font_size) style.fontSize = size.font_size;\n\n    // if this is a word, we don't want to set height (it breaks centering)\n    if (isSet('height', size) && !isWordMedia(stimulus.media)) style.height = size.height + '%';\n\n    if (isSet('width', size)) style.width = size.width + '%';\n\n    return el;\n}\n\nfunction isSet(prop, obj){return prop in obj;}\nfunction isWordMedia(media){ return _.isString(media) || _.isString(media.word); }\n\n","export default setPlace;\n\nfunction setPlace(el,stimulus){\n    var location = stimulus.location || {};\n\n    ['top','bottom','left','right'].forEach(setNumericLocation);\n\n    function isNumeric(val) {return !isNaN(+val);}\n    function setNumericLocation(attr){ if (isNumeric(location[attr])) el.style[attr] = location[attr] + '%'; }\n}\n","import fastdom from 'fastdom';\nimport setSize from './setSize';\nimport setPlace from './setPlace';\nimport css from 'minno-css';\nvar isIE = window.document.documentMode;\n\nexport default setupElement;\n\nfunction setupElement(el){\n    var stimulus = this;\n    var canvas = stimulus.canvas;\n\n    this.el = el;\n    return new Promise(function(resolve){\n        fastdom.mutate(function initStim(){\n            // setup element\n            el.classList.add('minno-stimulus');\n            el.setAttribute('data-handle', stimulus.handle); // data-handle for handeling of mouse/touch interactions\n            canvas.appendChild(el);\n\n            setSize(el, stimulus.source);\n            setPlace(el, stimulus.source);\n            css(el, stimulus.source.css || {});\n\n            if (!isIE) {\n                if (stimulus.source.isLayout) el.classList.add('minno-stimulus-visible');\n                resolve(el);\n            }\n            else fixIE(stimulus, resolve);\n        });\n    });\n}\n\n/**\n * sets element dimensions explicitly so that centering works in ie\n **/\nfunction fixIE(stimulus, resolve){\n    var canvas = stimulus.canvas;\n    var el = stimulus.el;\n    var location = stimulus.source.location || {};\n\n    fastdom.measure(function(){\n        var width = (100 * el.clientWidth / canvas.clientWidth);\n        var height = (100 * el.clientHeight / canvas.clientHeight);\n        fastdom.mutate(function(){\n            var style = el.style;\n            style.width = width + '%';\n            style.height = height + '%';\n            if (testProps(location.top, location.bottom)) { style.top = (100-height)/2+'%'; }\n            if (testProps(location.left, location.right)) { style.left = (100-width)/2+'%'; }\n            if (stimulus.source.isLayout) el.classList.add('minno-stimulus-visible');\n            resolve(el);\n        });\n    });\n\n    function testProps(p1, p2){\n        return p1 === 'center' || p2 === 'center' || (p1 === undefined && p2 === undefined);\n    }\n}\n","import fastdom from 'fastdom';\nimport getMedia from './getMedia';\nimport setupElement from './setupElement';\n\nexport default Stimulus;\n\nfunction Stimulus(stimulus, trial, canvas){\n    var self = {\n        el: null, // is set within init, some methods will break if not called before init...\n        source: stimulus,\n        trial: trial,\n        canvas: canvas,\n        init: init,\n        show: show,\n        hide: hide,\n        name: name,\n        mediaName: mediaName,\n        destroy: destroy\n    };\n\n    // make sure we have a data object\n    self.data = stimulus.data || {};\n\n    // set the handle\n    self.handle = self.data.handle = self.data.handle || stimulus.handle || stimulus.set;\n\n    return self;\n}\n\n\nfunction init(){\n    var source = this.source;\n    var $messages = this.trial.$messages;\n    if (!this.source.media) throw new Error('Media object not defined for ' + this.name());\n\n    return getMedia(this.source.media)\n        .then(setupElement.bind(this))\n        .catch(onError);\n\n    function onError(error){\n        $messages({type:'error', message: 'trial.stimulus error', error:error, context:source});\n        throw error;\n    }\n}\n\nfunction show(){\n    var el = this.el;\n    if (!el) throw new Error('A stimulus can not be shown before init is called');\n\n    fastdom.mutate(function showStim(){\n        el.classList.add('minno-stimulus-visible');\n    });\n}\n\nfunction hide(){\n    var el = this.el;\n    if (!el) throw new Error('A stimulus can not be hidden before init is called');\n\n    fastdom.mutate(function hideStim(){\n        el.classList.remove('minno-stimulus-visible');\n    });\n}\n\nfunction destroy(){\n    var el = this.el;\n    var canvas = this.canvas;\n    fastdom.mutate(function removeStim(){\n        canvas.removeChild(el);\n    });\n}\n\nfunction name(){\n    var source = this.source;\n    // if we have an alias ues it\n    if (source.alias) {return source.alias;}\n    if (this.data && this.data.alias) {return this.data.alias;} // if we have an alias ues it\n\n    if (source.inherit && source.inherit.set) {return source.inherit.set;} // otherwise try using the set we inherited from\n    if (this.handle) {return this.handle;} // otherwise use handle\n\n    // if no individual name is given, we set a default at the collection level\n}\n\nfunction mediaName(options){\n    var media = this.source.media;\n    var fullpath = options && options.fullpath; // as set within settings\n\n    if (media.alias) {return media.alias;} // if we have an alias ues it\n    if (media.data && media.data.alias) { return media.data.alias; }\n\n    for (var prop in media) {\n        if (contains(['image','template'],prop)) return fullpath ? media[prop] : media[prop].replace(/^.*[\\\\/]/, '');\n\n        // sometimes we have an empty value (this happens when we load a template and then translate it into an inline template)\n        if (contains(['word','html','inlineTemplate'],prop) && media[prop]) return media[prop];\n    }\n\n    // if no individual name is given, we set a default at the collection level\n}\n\nfunction contains(arr, val){ return arr.indexOf(val) != -1;}\n","import Stimulus from './Stimulus';\nimport _ from 'lodash';\n\nexport default stimCollection;\n\nfunction stimCollection(trial, canvas){\n    validateStimuli('stimuli', trial._source);\n    validateStimuli('layout', trial._source);\n\n    var source = trial._source;\n    var stimuli = _.map(source.stimuli, toStim);\n    var layout = _.map(source.layout, toLayout).map(toStim);\n    var stimReady = stimuli.concat(layout).map(function(stim){return stim.init();});\n\n    var self = {\n        canvas: canvas,\n        stimuli: stimuli,\n        layout: layout,\n        ready: Promise.all(stimReady),\n        getStimlist: getStimlist,\n        getMedialist: getMedialist,\n        destroy: destroy\n    };\n\n    return self;\n\n    function toStim(stim){ return Stimulus(stim, trial, canvas); }\n    function toLayout(stim){ stim.isLayout = true; return stim;}\n}\n\nfunction getStimlist(){\n    return this.stimuli\n        .filter(function(stim){return !stim.source.nolog;})\n        .map(function(stim, index){return stim.name() || ('stim' + index);});\n}\n\nfunction getMedialist(options){\n    return this.stimuli\n        .filter(function(stim){return !stim.source.nolog;})\n        .map(function(stim, index){return stim.mediaName(options) || ('media' + index);});\n}\n\nfunction destroy(){\n    this.stimuli.concat(this.layout).forEach(function(stim){stim.destroy();});\n}\n\nexport function validateStimuli(type, source){\n    var stimuli = source[type];\n    if (!stimuli) return;\n    if (!Array.isArray(stimuli)) throw new Error(type + ' must be an array');\n    if (!stimuli.every(function(stim){ return 'media' in stim; })) throw new Error('Each ' + type + ' stimulus must have a media property');\n}\n","import _ from 'lodash';\nimport globalGetter from '../../global';\n\nvar global = globalGetter();\nvar conditionHash = {\n    begin:begin,\n    inputEquals:inputEquals,\n    inputEqualsTrial:inputEqualsTrial,\n    inputEqualsStim:inputEqualsStim,\n    trialEquals:trialEquals,\n    inputEqualsGlobal:inputEqualsGlobal,\n    globalEquals:globalEquals,\n    globalEqualsTrial:globalEqualsTrial,\n    globalEqualsStim:globalEqualsStim,\n    currentEquals:currentEquals,\n    currentEqualsTrial:currentEqualsTrial,\n    currentEqualsStim:currentEqualsStim,\n    inputEqualsCurrent:inputEqualsCurrent,\n    fn:fn,\n    custom:custom,\n};\n\nexport default function getConditonFn(condition){\n    if (_.isFunction(condition)) return condition;\n    if (_.isFunction(conditionHash[condition.type])) return conditionHash[condition.type];\n    throw new Error('Unknown condition type: ' + JSON.stringify(condition));\n}\n\nfunction begin(inputData){ return inputData.type === 'begin'; }\n\nfunction inputEquals(inputData, condition){\n    var values = Array.isArray(condition.value) ? condition.value : [condition.value];\n    return values.indexOf(inputData.handle) !== -1;\n}\n\nfunction inputEqualsTrial(inputData, condition, trial){ return inputData.handle === trial.data[condition.property]; }\n\nfunction inputEqualsStim(inputData, condition, trial){\n    // create search object\n    var searchObj = {};\n    if (condition.handle) searchObj['handle'] = condition.handle;\n    searchObj[condition.property] = inputData.handle;\n\n    // are there stimuli answering this descriptions?\n    return hasData(searchObj,trial);\n}\n\nfunction trialEquals(inputData, condition, trial){\n    if (_.isUndefined(condition.property) || _.isUndefined(condition.value)) throw new Error('trialEquals requires both \"property\" and \"value\" to be defined');\n    return condition.value === trial.data[condition.property];\n}\n\nfunction inputEqualsGlobal(inputData, condition){\n    if (_.isUndefined(condition.property)) throw new Error('inputEqualsGlobal requires \"property\" to be defined');\n    return inputData.handle === global[condition.property];\n}\n\nfunction globalEquals(inputData, condition){\n    if (typeof condition.property == 'undefined' || typeof condition.value == 'undefined') throw new Error('globalEquals requires both \"property\" and \"value\" to be defined');\n    return condition.value === global[condition.property];\n}\n\nfunction globalEqualsTrial(inputData, condition, trial){\n    if (typeof condition.globalProp == 'undefined' || typeof condition.trialProp == 'undefined') throw new Error('globalEqualsTrial requires both \"globalProp\" and \"trialProp\" to be defined');\n    return global[condition.globalProp] === trial.data[condition.trialProp];\n}\n\nfunction globalEqualsStim(inputData, condition, trial){\n    if (typeof condition.globalProp == 'undefined' || typeof condition.stimProp == 'undefined') throw new Error('globalEqualsStim requires both \"globalProp\" and \"stimProp\" to be defined');\n\n    // create search object\n    var searchObj = {};\n    if (condition.handle) searchObj['handle'] = condition.handle;\n    searchObj[condition.stimProp] = global[condition.globalProp];\n\n    // are there stimuli answering this descriptions?\n    return hasData(searchObj,trial);\n}\n\nfunction inputEqualsCurrent(inputData, condition){\n    var current = global.current;\n    if (typeof condition.property == 'undefined') throw new Error('inputEqualsCurrent requires \"property\" to be defined');\n    return inputData.handle === current[condition.property];\n}\nfunction currentEquals(inputData, condition){\n    var current = global.current;\n    if (typeof condition.property == 'undefined' || typeof condition.value == 'undefined') throw new Error('currentEquals requires both \"property\" and \"value\" to be defined');\n    return condition.value === current[condition.property];\n}\n\nfunction currentEqualsTrial(inputData, condition, trial){\n    var current = global.current;\n    if (typeof condition.currentProp == 'undefined' || typeof condition.trialProp == 'undefined') throw new Error('currentEqualsTrial requires both \"currentProp\" and \"trialProp\" to be defined');\n    return current[condition.currentProp] === trial.data[condition.trialProp];\n}\n\nfunction currentEqualsStim(inputData, condition, trial){\n    var current = global.current;\n    if (typeof condition.currentProp == 'undefined' || typeof condition.stimProp == 'undefined') throw new Error('currentEqualsStim requires both \"currentProp\" and \"stimProp\" to be defined');\n\n    // create search object\n    var searchObj = {};\n    if (condition.handle) searchObj['handle'] = condition.handle;\n    searchObj[condition.stimProp] = current[condition.currentProp];\n\n    // are there stimuli answering this descriptions?\n    return hasData(searchObj, trial);\n}\n\nfunction fn(inputData, condition, trial){\n    return condition.value.apply(trial,[condition,inputData, trial]);\n}\n\nfunction custom(inputData, condition, trial){\n    return condition.fn.apply(null, [condition, inputData, trial]);\n}\n\nfunction hasData(searchObj, trial){\n    return trial.stimulusCollection.stimuli.some(function(stim){\n        var data = stim.data;\n        for (var key in searchObj) {\n            if (searchObj[key] !== data[key]) return false;\n        }\n        return true;\n    });\n}\n","/*\n * gets a condition array (or a single condition) and evaluates it\n * returns true if all statements are true, false otherwise\n *\n * a single condition looks like this:\n *\n *\tcondition = {\n *\t\ttype : 'begin/inputEquals/inputEqualsTrial/inputEqualsStim/function',\n *\t\tvalue: 'right/trialAttribute/stimAttribute/customFunction',\n *\t\thandle: 'stim handle' (optional in case we're targeting a stimulus)\n *\t}\n *\n */\n\nimport getConditionFn from './getConditionFn';\n\nexport default conditionsEvaluate;\n\nfunction conditionsEvaluate(conditions, inputData, trial){\n    // make sure conditions is an array\n    conditions = Array.isArray(conditions) ? conditions : [conditions];\n\n    // if this is a begin event, make sure we only run interactions that have begin in them\n    if (inputData.type == 'begin' && conditions.every(function(condition){return condition.type != 'begin';})) return false;\n\n    return conditions.every(checkCondition);\n\n\n    function checkCondition(condition){\n        var value = getConditionFn(condition)(inputData, condition, trial);\n        return condition.negate ? !value : value;\n    }\n}\n","import _ from 'lodash';\nimport fastdom from 'fastdom';\nimport global from '../../global';\nimport applyCanvasStyles from '../../task/canvas/applyCanvasStyles';\n\nexport default actions;\n\n// @TODO: see if we can afford to change the signature of actions\n// I'd like to have the trial go first here (used almost always).\nvar actions = {\n    /*\n     * Stimulus actions\n     */\n    showStim: function(action, eventData, trial){\n        var handle = action.handle || action;\n        trial.stimulusCollection.stimuli.forEach(function(stim){\n            if (handle == 'All' || stim.handle == handle) stim.show();\n        });\n    },\n\n    hideStim: function(action, eventData, trial){\n        var handle = action.handle || action;\n        trial.stimulusCollection.stimuli.forEach(function(stim){\n            if (handle == 'All' || stim.handle == handle) stim.hide();\n        });\n    },\n\n    setStimAttr: function(action, eventData, trial){\n        var handle = action.handle;\n        var setter = action.setter;\n        trial.stimulusCollection.stimuli.forEach(function(stim){\n            if (handle == 'All' || stim.handle == handle) {\n                if (_.isFunction(setter)) setter.apply(stim);\n                else _.extend(stim.data, setter);\n            }\n        });\n    },\n\n    /*\n     * Trial actions\n     */\n    setTrialAttr: function(action, eventData, trial){\n        var setter = action.setter;\n        if (typeof setter == 'undefined') throw new Error('The setTrialAttr action requires a setter property');\n        if (_.isFunction(setter)) setter.apply(trial, [trial.data,eventData]);\n        else _.extend(trial.data,setter);\n    },\n\n    setInput: function(action, eventData, trial){\n        if (typeof action.input == 'undefined') throw new Error('The setInput action requires an input property');\n        trial.input.add(action.input);\n    },\n\n    trigger: function(action, eventData, trial){\n        if (typeof action.handle == 'undefined') throw new Error('The trigger action requires a handle property');\n        trial.input.add({handle:action.handle, on:'timeout', duration:+action.duration || 0});\n    },\n\n    removeInput: function(action, eventData, trial){\n        var input = trial.input;\n        var handleList = action.handle;\n        if (typeof handleList == 'undefined') throw new Error('The removeInput action requires a handle property');\n        if (!Array.isArray(handleList)) handleList = [handleList];\n        if (_.includes(handleList,'All')) input.removeAll();\n        else handleList.forEach(input.remove);\n    },\n\n    goto: function(action, eventData, trial){\n        trial._next = [action.destination,action.properties];\n    },\n\n    endTrial: function(){\n        // this is explicitly managed in interaction.js\n        // in order to improve trial lifecycle control\n    },\n\n    resetTimer: function(action,eventData,trial){\n        // when to reset timer\n        action.immidiate ? reset() :  fastdom.mutate(reset);\n\n        function reset(){\n            eventData.latency = 0;\n            trial.input.resetTimer();\n        }\n    },\n\n    /*\n     * Logger\n     */\n\n    log: function(action,eventData,trial){\n        trial.$logs(arguments);\n    },\n\n    /*\n     * Misc\n     */\n\n    setGlobalAttr: function(action){\n        switch (typeof action.setter){\n            case 'function':\n                action.setter.apply(null,[global(), action]);\n                break;\n            case 'object':\n                _.extend(global(), action.setter);\n                break;\n            default:\n                throw new Error('setGlobalAttr requires a \"setter\" property');\n        }\n    },\n\n    custom: function(action,eventData, trial){\n        if (typeof action.fn != 'function') throw new Error('The custom action requires a fn propery');\n        action.fn(action, eventData, trial);\n    },\n\n    canvas: function(action, eventData, trial){\n        var canvas = trial.cavnas;\n        var map = {\n            background \t\t\t: {element: document.body, property: 'backgroundColor'},\n            canvasBackground\t: {element: canvas, property:'backgroundColor'},\n            borderColor\t\t\t: {element: canvas, property:'borderColor'},\n            borderWidth\t\t\t: {element: canvas, property:'borderWidth'}\n        };\n\n        // settings activator\n        var off = applyCanvasStyles(map, _.pick(action,['background','canvasBackground','borderColor','borderWidth']));\n        trial.$end.map(off);\n    },\n\n    /*\n     *  Mouse tracking\n     */\n    startMouseTracking: function(action, eventData, trial){\n        if (trial.data.listener) return trial.$message({ type:'warn', message: 'Mouse tracking has already been activated.' });\n\n        var startTime = performance.now();\n        var canvas = trial.canvas;// get its computed style\n        var logAs = action.logAs || 'mousetracker';\n\n        // get canvas borders so that we can compute relative to the content box\n        var styling = getComputedStyle(canvas);\n        var topBorder = parseInt(styling.getPropertyValue('border-top-width'));\n        var leftBorder = parseInt(styling.getPropertyValue('border-left-width'));\n\n        var trackedStimuli = trial.stimulusCollection.stimuli.filter(function(stim){ return _.includes(action.logStimulusLocation, stim.handle); });\n\n        var listener = _.throttle(function(e){\n            var canvasLocation = canvas.getBoundingClientRect();\n            var correctedCanvas = {x:canvasLocation.x+leftBorder, y:canvasLocation.y+topBorder};\n            var mouseLocation = { mouseX: e.clientX - correctedCanvas.x, mouseY: e.clientY - correctedCanvas.y };\n\n            var locations = trackedStimuli.reduce(function(acc, val){\n                var rect = val.el.getBoundingClientRect();\n                _.set(acc, val.handle+'X',rect.x - correctedCanvas.x);\n                _.set(acc, val.handle+'Y',rect.y - correctedCanvas.y);\n                _.set(acc, val.handle+'Width',rect.width);\n                _.set(acc, val.handle+'Height',rect.height);\n                return acc;\n            }, mouseLocation);\n\n            var results = _.mapValues(_.set(locations, 'time', performance.now()-startTime), Math.round);\n\n            trial.data[logAs].push(results);\n        }, action.logRate || 15);\n\n        trial.data[logAs] || (trial.data[logAs] = []);\n        trial.data.$listener = listener;\n\n        document.addEventListener('mousemove', listener);\n        trial.$events.end.map(function(){ // make sure that the listener is removed at the end of the trial\n            document.removeEventListener('mousemove', listener);\n        });\n    },\n\n\n    stopMouseTracking: function(e, ed, trial){\n        if (_.isFunction(trial.data.$listener)) { \n            document.removeEventListener('mousemove', trial.data.$listener);\n            trial.data.$listener = null;\n        }\n    }\n};\n\n","/*\n * accepts an array of actions (or a single action)\n * and applies them\n *\n * actions = [\n *\t\t{type:actionName,more:options},\n *\t\t{actionName:options}\n * ]\n * @param actions: single action object or array of action objects\n * @param eventData: eventData object\n * @returns Boolean: endTrial whether this action stops further action activations\n */\n\nimport _ from 'lodash';\nimport actionList from './actionList';\n\nexport default applyActions;\n\nfunction applyActions(actions, eventData, trial){\n    // marks whether this is the final action to take\n    var endTrial = false;\n\n    actions = _.isArray(actions) ? actions : [actions];\n\n    _.forEach(actions,function(action){\n        var actionFn = _.isFunction(action) ? action : actionList[action.type];\n        if (!actionFn) throw new Error('unknown action: ' + action.type);\n\n        // the only reason to halt action activation is the endTrial command\n        if (action.type === 'endTrial') endTrial = true;\n        actionFn(action, eventData, trial);\n    });\n\n    return endTrial;\n}\n","/*\n* Organizer for the interaction function\n*/\n\nimport evaluate from './conditionsEvaluate';\nimport activate from './action';\nimport _ from 'lodash';\n\nexport default interactions;\n\n/*\n * Trial -> Event -> Event\n *\n * Can use trial to produce side efects\n **/\n\nvar MAX_RECURSION_DEPTH = 50;\nfunction interactions(trial){\n    var recursionDepth = 0;\n    var interactions = trial._source.interactions;\n\n    try {\n        validateInteractions(interactions);\n    } catch(error){\n        trial.$messages({type:'error', message: 'trial.interactions error', error:error, context:trial._source});\n        throw error;\n    }\n    return eventMap;\n\n    function eventMap(event){\n        var i, interaction, conditionTrue, endTrial;\n        var groupName = 'Event: ' + (event.handle || event.type);\n        var debugLog = [];\n\n        if (recursionDepth > MAX_RECURSION_DEPTH) throw new Error('It seem you have created an infinite loop. Minno has been halted');\n\n        recursionDepth++;\n        try{\n            // use an explicit for loop because we need to be able to break\n            for (i=0; i<interactions.length; i++){\n                interaction = interactions[i];\n\n                conditionTrue = evaluate(interaction.conditions, event, trial);\n                debugLog.push([conditionTrue, interaction.conditions]);\n\n                if (conditionTrue) endTrial = activate(interaction.actions, event, trial);\n\n                // if this action includes endTrial we want to stop evalutation immidiately\n                if (endTrial) break;\n            }\n\n        } catch(error){\n            trial.$messages({type:'error', message: 'trial.interactions error', error:error});\n            throw error;\n        }\n        recursionDepth--;\n\n        trial.$messages({type:'debug', message: groupName, rows: debugLog});\n\n        // this is here and not within actions so that messages can be sent befor ending the trial\n        if (endTrial) trial.end();\n\n        return event;\n    }\n}\n\nexport function validateInteractions(interactions){\n    if (!Array.isArray(interactions)) throw new Error('Interactions must be an array');\n    if (!interactions.length) throw new Error('There are no interactions defined');\n\n    if (!interactions.every(_.isPlainObject)) throw new Error('Interactions must be plain objects');\n    if (!interactions.every(isValidProp('conditions'))) throw new Error('Conditions must be either an array or a function');\n    if (!interactions.every(isValidProp('actions'))) throw new Error('Actions must be either an array or a function');\n\n    function isValidProp(prop){\n        return function(interaction) {\n            return Array.isArray(interaction[prop]) || _.isFunction(interaction[prop]);\n        };\n    }\n}\n\n","import _ from 'lodash';\nimport input from './input/input';\nimport stimulusCollection from './stimulus/stimulusCollection';\nimport interactions from './interactions/interactions';\nimport stream from 'mithril-stream';\n\nexport default Trial;\n\nvar gid = 0;\n\n// data is already fully inflated\nfunction Trial(source, canvas, settings){\n    // make sure we have all our stuff :)\n    if (!source.interactions) throw new Error('Interactions not defined');\n\n    this.canvas = canvas;\n    this.settings = settings;\n    this._source = source;\n\n    this.$logs = stream();\n    this.$messages = stream();\n    this.$events = stream();\n    this.$end = this.$events.end;\n\n    // make sure we always have a data container\n    this.data = source.data || {};\n\n    // create a uniqueId for this trial\n    this._id = _.uniqueId('trial_');\n    this.counter = gid++;\n\n    this.input = input(this.$events, canvas);\n    this.stimulusCollection = stimulusCollection(this, canvas);\n\n    // the next trial we want to play\n    // by default this is simply the next trial, this can be changed using the goto action\n    // the syntax is [destination, properties]\n    this._next = ['next',{}];\n}\n\n_.extend(Trial.prototype,{\n    start: function(){\n        var trial = this;\n\n        // wait until all simuli are loaded\n        return trial.stimulusCollection.ready.then(function(){\n            // listen for interactions\n            trial.$events\n                .map(addTrialDetails(trial))\n                .map(interactions(trial));\n\n            // activate input\n            _.forEach(trial._source.input, trial.input.add); // add each input\n            trial.input.resetTimer(); // reset the interface timer so that event latencies are relative to now.\n            // start running\n            trial.$events({type:'begin',latency:0});\n        });\n    },\n\n    end: function(){\n        // remove all listeners\n        this.input.removeAll();\n        this.$end(true);\n    },\n\n    name: function(){\n        // if we have an alias ues it\n        if (this.alias) { return this.alias; }\n        if (this.data.alias) { return this.data.alias; }\n\n        // otherwise try using the set we inherited from\n        if (_.isString(this._source.inherit)) return this._source.inherit;\n        if (_.isPlainObject(this._source.inherit)) return this._source.inherit.set;\n\n        // we're out of options here\n    }\n});\n\nfunction addTrialDetails(trial){\n    return function(event){\n        return _.assign(event, {\n            trialId     : trial._id,\n            counter     : trial.counter\n        });\n    };\n}\n","import createListener from './createListener';\nimport now from './now';\n\nexport default interfaceFn;\n\nfunction interfaceFn($events, canvas){\n    var listenerStack = []; // holds all active listeners\n    var baseTime = 0;\n\n    return { add:add,remove:remove,removeAll:removeAll,resetTimer:resetTimer };\n\n    function add(inputObj){\n        if (!inputObj) throw new Error('Missing input element. Could not add input listener');\n        var $listener = createListener(inputObj, canvas);\n        $listener.map(addDetails).map($events); // pipe events to $events\n        listenerStack.push($listener);\n\n        function addDetails(event){\n            return {\n                handle      : $listener.handle,\n                event       : event,\n                timestamp\t: +new Date(),\n                latency\t\t: now() - baseTime\n            };\n        }\n    }\n\n    function remove(handle){\n        // go through the listener stack and remove any listeners that fit the handle\n        // note that we do this in reverse so that the index does not change\n        for (var i = listenerStack.length - 1; i >= 0 ; i--){\n            var $listener = listenerStack[i];\n            if ($listener.handle === handle){\n                $listener.end(true);\n                listenerStack.splice(i,1);\n            }\n        }\n    }\n\n    function removeAll(){\n        listenerStack.forEach(function($listener){\n            $listener.end(true);\n        });\n        listenerStack.length = 0;\n    }\n\n    function resetTimer(){ baseTime = now(); }\n}\n","import _ from 'lodash';\n\nexport default transformLogs;\n\nfunction transformLogs(action,eventData,trial){\n    var global = window.piGlobal;\n    var trialData = trial.data, inputData = eventData, logStack = global.current.logs;\n    var fullpath = _.get(trial, 'settings.logger.fullpath', false);\n\n    var stimList = trial.stimulusCollection.getStimlist();\n    var mediaList = trial.stimulusCollection.getMedialist({fullpath:fullpath});\n\n    return {\n        log_serial : logStack.length,\n        trial_id: trial.counter,\n        name: trial.name(),\n        responseHandle: inputData.handle,\n        latency: Math.floor(inputData.latency),\n        stimuli: stimList,\n        media: mediaList,\n        data: trialData\n    };\n}\n","import _ from 'lodash';\nimport stream from 'mithril-stream';\n\nimport Trial from './trial/Trial';\nimport nextTrial from './task/sequencer/nextTrial';\nimport createLogs from './task/logger/createLogStream';\nimport defaultLogMap from './task/logger/defaultLogMap';\nimport piGlobal from './global';\n\nexport default playerPhase;\n\n/**\n * run the task\n * Essentialy wiring up all the play phase stuff\n * @TODO: document this function, its super complicated\n **/\n\nfunction playerPhase(sink){\n\n    var canvas = sink.canvas;\n    var db = sink.db;\n    var settings = sink.settings;\n    var global = piGlobal();\n\n    var $source = stream(); // a stream of trial POJO\n    var $trial = $source.map(activateTrial());\n    var $sourceLogs = stream();\n    var $messages = stream();\n    var $logs = createLogs($sourceLogs, composeLoggerSettings(sink.script, global), defaultLogMap);\n    var onDone = _.get(settings, 'hooks.endTask', settings.onEnd || _.noop);\n\n    // expose logs on current\n    $logs.map(function(log){\n        global.current.logs.push(log);        \n    });\n\n    $source.end\n        .map($trial.end)\n        .map($sourceLogs.end)\n        .map(clearCanvas)\n        .map(onDone);\n\n    return _.extend({\n        $trial:$trial, \n        end: $source.end.bind(null,true), \n        $logs: $logs,\n        $messages: $messages,\n        start: play.bind(null, ['next', {}]),\n        onEnd: function(fn){ $source.end.map(fn); }\n    }, sink);\n\n    function clearCanvas(){\n        var trial = $trial();\n        if (trial) trial.stimulusCollection.destroy();\n    }\n\n    function play(goto){\n        var next = nextTrial(db, settings, goto);\n        if (next.done) $source.end(true);\n        else $source(next.value);\n    }\n\n    function activateTrial(cache){\n        return activate;\n        function activate(source){\n            var oldTrial = cache;\n            var trial = cache = new Trial(source, canvas, settings);\n            trial.$logs.map($sourceLogs); \n            trial.$messages.map($messages); \n\n            // must be *before* the subscription to $end for the next trial\n            if (source.DEBUG && window.DEBUG) setupDebug(trial);\n\n            trial.$end.map(function(){\n                play(trial._next); // when we're done try to play the next one\n            });\n\n            trial.start();\n\n            // we leave the old stimuli until the current ones are ready to maintain the continuity between trials\n            if (oldTrial) trial.stimulusCollection.ready.then(function(){\n                oldTrial.stimulusCollection.destroy();\n            });\n\n            return trial;\n        }\n    }\n}\n\nfunction setupDebug(trial){\n    /* eslint-disable no-console */\n    var trialName = 'Trial :' + trial.counter;\n    console.group(trialName);\n    trial.$messages.map(debugLog);\n    trial.$events.end.map(function(){ console.groupEnd(trialName); });\n\n    function debugLog(log){\n        if (log.type !== 'debug') return log;\n        if (log.rows){\n            console.groupCollapsed(log.message);\n            log.rows.forEach(function(row){ console.log.apply(console, row); });\n            console.groupEnd(log.message);\n        }\n        else console.log(log.message);\n        return log;\n    }\n    /* eslint-enable no-console */\n}\n\n// create metaDeta to add to post\nexport function composeLoggerSettings(script, global){\n    var loggerSettings = _.assign({}, _.get(script, 'settings.logger'));\n    var metaData = _.assign({taskName:script.name}, global.$meta, loggerSettings.metaData);\n    loggerSettings.metaData = metaData;\n    return loggerSettings;\n}\n","export default createLogs;\n\nfunction createLogs($sourceLogs, settings, defaultLogMap){\n    var logMap = settings.logger || settings.logMap || defaultLogMap;\n    return  $sourceLogs.map(applyMap(logMap));\n\n    // $logs is a stream of arrays, we want to apply them as args to the transform function\n    function applyMap(fn){\n        return function(args){ return fn.apply(null,args); };\n    }\n}\n","import _ from 'lodash';\nimport globalGetter from '../../global';\nimport buildUrl from './buildUrl';\n\nexport default nextTrial;\n\nfunction nextTrial(db, settings, goto){\n    var destination = goto[0], properties = goto[1];\n    var sequence = db.currentSequence;\n    var global = globalGetter();\n    var context = {global: global, current: global.current};\n    var source;\n\n    sequence.go(destination, properties, context);\n    source = sequence.current(context, {skip:['layout','stimuli']});\n    source = _.clone(source);\n\n    if (!source) return {done:true};\n\n    source.stimuli = _.map(source.stimuli || [], buildStim.bind(context));\n    source.layout = _.map(source.layout || [], buildStim.bind(context));\n\n    context.trialData = null;\n\n    return {value:source};\n\n    function buildMedia(stim, prop, context){\n        var val = stim[prop];\n\n        if (_.isUndefined(val)) return false;\n        if (_.isString(val)) val = {word: val};\n\n        val = db.inflate('media', val, context);\n\n        // note that the base url is added to the media object during the sequence preload\n        // if needed, build url\n        if (val.image) val.$image = buildUrl(settings.base_url, val.image, 'image');\n\n        if (val.template){\n            // @TODO: remove dependency on requirejs\n            val.inlineTemplate = requirejs('text!' + buildUrl(settings.base_url, val.template, 'template'));\n            val.inlineTemplate = _.template(val.inlineTemplate)(context);\n        }\n\n        stim[prop] = val;\n\n        context.mediaData = null;\n        context.mediaMeta = null;\n    }\n\n    function buildStim(stim){\n        var context = this;\n\n        stim = db.inflate('stimulus', stim, context, {skip:['media','touchMedia']});\n        stim = _.clone(stim);\n        buildMedia(stim, 'media', context);\n        buildMedia(stim, 'touchMedia', context);\n        context.stimulusData = null;\n        context.stimulusMeta = null;\n        return stim;\n    }\n}\n","import './polyfills';\nimport './time.css';\n\nimport setup from './app/setup';\nimport preloadPhase from './app/preloadPhase';\nimport playPhase from './app/playPhase';\n\nexport default activate;\n\n/**\n * activate : (HTMLelement, timeScript) -> Sink\n *\n * timeScript : {settings, sequence, trialSets, stimulusSets, mediaSets, current}\n * Sink: {$trial, $logs, play, end}\n **/\nfunction activate(canvas, script){\n    var sink = setup(canvas, script);\n    var playSink = playPhase(sink);\n\n    playSink.$trial.end.map(playSink.$resize.end); // end resize stream\n\n    // preload Images, then start \"playPhase\"\n    preloadPhase(canvas, script, playSink.$messages).then(playSink.start);\n\n    return playSink;\n}\n\n","import scriptPreloader from './task/sequencer/scriptPreloader';\nimport fastdom from 'fastdom';\n\nexport default preloadPhase;\n\nfunction preloadPhase(canvas, script, $messages){\n    var preloader = scriptPreloader(script, script.settings.base_url);\n\n    if (preloader.progress() == 1) return Promise.resolve().then(emptyCanvas);\n\n    canvas.innerHTML = '<div class=\"minno-progress\"><div class=\"minno-progress-bar\"></div></div>';\n\n    var barStyle = canvas.getElementsByClassName('minno-progress-bar')[0].style;\n    barStyle.width = preloader.progress() + '%';\n    preloader.onload = function(){\n        fastdom.mutate(function(){\n            barStyle.width = preloader.progress()*100 + '%';\n        });\n    };\n    preloader.onerror = function(e, src){\n        $messages({\n            type:'error',\n            message: 'Failed to preload',\n            error:e,\n            context:src\n        });\n    };\n\n    return preloader.all()\n        .then(emptyCanvas)['catch'](function(src){\n            throw new Error('loading resource failed, do something about it! (you can start by checking the error log, you are probably reffering to the wrong url - ' + src +')');\n        });\n\n    function emptyCanvas(){\n        while (canvas.firstChild) canvas.removeChild(canvas.firstChild);\n    }\n}\n\n"],"names":["log","console","apply","arguments","Date","now","getTime","w","perfNow","perfNowNames","i","length","n","window","group","groupCollapsed","groupEnd","table","vendors","requestAnimationFrame","vp","cancelAnimationFrame","test","navigator","userAgent","lastTime","callback","nextTime","Math","max","setTimeout","clearTimeout","PromisePolyfill","executor","this","Error","TypeError","self","resolvers","rejectors","resolveCurrent","handler","rejectCurrent","instance","_instance","callAsync","setImmediate","list","shouldAbsorb","execute","value","then","error","state","retry","executeOnce","bind","e","runs","run","fn","onerror","prototype","onFulfilled","onRejection","resolveNext","rejectNext","handle","next","push","promise","resolve","reject","catch","all","total","count","values","consume","race","Promise","glob","piGlobal","global","go","destination","properties","context","mixerSequence","where","prev","current","direction","sequence","curr","_","iteratee","data","win","debug","raf","webkitRequestAnimationFrame","mozRequestAnimationFrame","msRequestAnimationFrame","cb","FastDom","reads","writes","scheduleFlush","fastdom","scheduled","runTasks","message","tasks","task","shift","remove","array","item","index","indexOf","splice","constructor","measure","ctx","mutate","clear","extend","props","child","Object","create","target","source","key","hasOwnProperty","mixin","initialize","exports","module","parse","num","parseFloat","adjust_canvas","canvas","settings","throttle","event","type","resize","targetSize","proportions","isPlainObject","height","width","every","isFinite","getProportions","docElement","document","documentElement","maxHeight","clientHeight","maxWidth","min","Infinity","clientWidth","el","computedStyle","getComputedStyle","offsetHeight","borderTopWidth","borderBottomWidth","offsetWidth","borderLeftWidth","borderRightWidth","getSize","parentNode","getTargetSize","marginTop","style","fontSize","textSize","scrollTo","canvasContructor","map","offArr","isUndefined","noop","rule","property","old","on","element","forEach","call","createStream","stream","HALT","updateStream","_state","id","guid","undefined","derive","recover","deps","parents","endStream","unregister","ap","valueOf","toJSON","toString","defineProperties","end","get","unregisterStream","initStream","updateState","updateDependency","changed","finalize","mustSync","active","some","combine","streams","valid","dep","filter","notEnded","registerDependency","initDependency","concat","dependent","s1","s2","merge","s","scan","reducer","seed","newStream","scanMerge","tuples","tuple","idx","obj","str","replace","g","toUpperCase","setup","script","$resize","canvasSettings","isElement","classList","add","off","applyCanvasStyles","background","body","canvasBackground","borderColor","borderWidth","pick","css","adjustCanvas","addEventListener","removeEventListener","canvasSetup","db","Database","createColl","trialSets","stimulusSets","mediaSets","isArray","currentSequence","createDB","name","logs","setupVars","srcStack","defStack","stackDone","getText","memoize","url","request","XMLHttpRequest","open","onreadystatechange","readyState","status","responseText","send","loader","load","src","createElement","onload","getImage","progress","buildUrl","baseUrl","isObject","preloadScript","getStimMedia","getTrialMedia","notMixer","flattenDeep","notUndefined","getScriptMedia","media","image","preloader","template","trial","input","stimuli","layout","stim","mixer","val","mouseEvents","eventName","inputObj","$listener","appendChild","getAttribute","stimHandle","removeChild","keyDownArr","keypressed","Array","charCodeAt","keypressListener","which","preventDefault","timeout","duration","floor","random","isFunction","isNumber","randomize","inputBinder","keyup","assign","position","left","opacity","right","top","bottom","css2","css1","createListener","isString","binder","getListener","isStream","JSON","stringify","logObj","performance","getMedia","html","inlineTemplate","p","isThenable","customMedia","isWord","word","textContent","innerHTML","$image","jquery","setSize","stimulus","size","font_size","isSet","isWordMedia","prop","setPlace","location","attr","isNaN","isNumeric","isIE","documentMode","setupElement","setAttribute","testProps","p1","p2","isLayout","fixIE","init","$messages","show","hide","destroy","alias","inherit","set","mediaName","options","fullpath","contains","arr","stimCollection","validateStimuli","_source","toStim","stimReady","ready","getStimlist","getMedialist","Stimulus","nolog","globalGetter","conditionHash","begin","inputData","inputEquals","condition","inputEqualsTrial","inputEqualsStim","searchObj","hasData","trialEquals","inputEqualsGlobal","globalEquals","globalEqualsTrial","globalProp","trialProp","globalEqualsStim","stimProp","currentEquals","currentEqualsTrial","currentProp","currentEqualsStim","inputEqualsCurrent","custom","stimulusCollection","conditionsEvaluate","conditions","getConditionFn","negate","actions","showStim","action","eventData","hideStim","setStimAttr","setter","setTrialAttr","setInput","trigger","removeInput","handleList","includes","removeAll","goto","_next","endTrial","resetTimer","reset","latency","immidiate","$logs","setGlobalAttr","cavnas","$end","startMouseTracking","listener","$message","startTime","logAs","styling","topBorder","parseInt","getPropertyValue","leftBorder","trackedStimuli","logStimulusLocation","canvasLocation","getBoundingClientRect","correctedCanvas","x","y","mouseLocation","mouseX","clientX","mouseY","clientY","locations","reduce","acc","rect","results","mapValues","round","logRate","$events","stopMouseTracking","ed","applyActions","actionFn","actionList","interactions","recursionDepth","isValidProp","interaction","validateInteractions","conditionTrue","groupName","debugLog","evaluate","activate","rows","gid","Trial","_id","uniqueId","counter","listenerStack","baseTime","timestamp","transformLogs","trialData","logStack","stimList","mediaList","log_serial","trial_id","responseHandle","playerPhase","sink","cache","$source","$trial","oldTrial","$sourceLogs","DEBUG","trialName","row","setupDebug","play","start","defaultLogMap","logMap","logger","args","createLogs","loggerSettings","metaData","taskName","$meta","composeLoggerSettings","onDone","onEnd","skip","clone","buildStim","done","buildMedia","inflate","base_url","requirejs","mediaData","mediaMeta","stimulusData","stimulusMeta","nextTrial","trialId","addTrialDetails","playSink","playPhase","scriptPreloader","emptyCanvas","barStyle","getElementsByClassName","firstChild","preloadPhase"],"mappings":"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"}