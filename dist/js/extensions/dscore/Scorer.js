define("utils/polyfills",[],function(){Date.now||(Date.now=function(){return(new Date).getTime()}),function(){"use strict";for(var e=["webkit","moz"],r=0;r<e.length&&!window.requestAnimationFrame;++r){var a=e[r];window.requestAnimationFrame=window[a+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a+"CancelAnimationFrame"]||window[a+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var t=0;window.requestAnimationFrame=function(e){var r=Date.now(),a=Math.max(t+16,r);return setTimeout(function(){e(t=a)},a-r)},window.cancelAnimationFrame=clearTimeout}}()}),define("pipScorer/computeD",["require","underscore"],function(e){function r(){a.assign(this,{dataArray:{},AnalyzedVar:"latency",ErrorVar:"error",condVar:"",cond1VarValues:[],cond2VarValues:[],parcelVar:"",parcelValue:[],fastRT:300,maxFastTrialsRate:.1,minRT:400,maxRT:1e4,maxErrorParcelRate:.4,errorLatency:{use:"latency",penalty:600,useForSTD:!0},postSettings:{}})}var a=e("underscore");return a.assign(r.prototype,{setComputeObject:function(e){a.assign(this,e)},setDataArray:function(){var e=window.piGlobal;this.dataArray=e.current.logs}}),r}),define("pipScorer/msgMan",["require","underscore"],function(e){function r(){this.messages=a.extend({},t)}var a=e("underscore"),t={MessageDef:[],manyErrors:"There were too many errors made to determine a result.",tooFast:"There were too many fast trials to determine a result.",notEnough:"There were not enough trials to determine a result."};return a.extend(r.prototype,{setMsgObject:function(e){a.extend(this.messages,e)},getScoreMsg:function(e){var r=this.messages.MessageDef;if(!r||!r.length)throw new Error('You must define a "MessageDef" array.');var t=parseFloat(e),n=null,o=null,s="error: msg was not set",i=!1;if(a.each(r,function(e){n=parseFloat(e.cut),o=e.message,n>=t&&!i&&(s=o,i=!0)}),!i){var c=r.length,u=r[c-1];s=u.message}return s},getMessage:function(e){return this.messages[e]}}),r}),define("pipScorer/parcelMng",["require","underscore"],function(e){function r(e){this.parcelArray=[],this.scoreData={},this.msgMan=e}var a=e("underscore");return a.extend(r.prototype,{Init:function(e){var r=this,t=this.msgMan,n=window.piGlobal,o=n.current.logs;r.parcelArray=[],r.scoreData={},r.msgMan=t;var s=e.AnalyzedVar,i=e.ErrorVar,c=e.parcelVar,u=e.parcelValue,l=e.minRT,g=e.maxRT,d=e.fastRT,h=0,f=0,p=0,m=0,v=parseFloat(e.maxFastTrialsRate);if("undefined"==typeof u||0===u.length){p=0,h=0,f=0,m=0;var y={};y.name="general",y.trialIData=[],a.each(o,function(a){a[s]>=l&&a[s]<=g?(p++,1==a.data[i]&&m++,r.validate(y,a,e)&&h++):a[s]<=d&&f++}),r.checkErrors(p,m,e),r.parcelArray[0]=y}else a.each(u,function(t,n){p=0,h=0,f=0,m=0;var u={};u.name=t,u.trialIData=[],a.each(o,function(a){var n=a.data[c];n==t&&(a[s]>=l&&a[s]<=g?(p++,1==a.data[i]&&m++,r.validate(u,a,e)&&h++):a[s]<=d&&f++)}),r.checkErrors(p,m,e),r.parcelArray[n]=u});f/h>v&&(r.scoreData.errorMessage=this.msgMan.getMessage("tooFast"))},checkErrors:function(e,r,a){var t=a.maxErrorParcelRate;r/e>t&&(this.scoreData.errorMessage=this.msgMan.getMessage("manyErrors"))},validate:function(e,r,a){var t=a.errorLatency,n=a.ErrorVar,o=r.data;return"latency"==t.use?(e.trialIData.push(r),!0):"false"==t.use?"1"==o[n]?!1:(e.trialIData.push(r),!0):"penalty"==t.use?(e.trialIData.push(r),!0):void 0},addPenalty:function(e,r){var t=r.errorLatency,n=this;if("penalty"==t.use){var o=parseFloat(t.penalty),s=r.ErrorVar,i=r.AnalyzedVar,c=r.condVar,u=r.cond1VarValues,l=r.cond2VarValues,g=e.trialIData,d=e.avgCon1,h=e.avgCon2;a.each(g,function(e){var r=e.data,a=r[s],t=r[c],g=n.checkArray(t,u),f=n.checkArray(t,l);"1"==a&&(g?e[i]+=d+o:f&&(e[i]+=h+o))})}},avgAll:function(e){var r=this;a.each(r.parcelArray,function(a){r.avgParcel(a,e)})},avgParcel:function(e,r){var t=this,n=e.trialIData,o=r.condVar,s=r.cond1VarValues,i=r.cond2VarValues,c=r.AnalyzedVar,u=0,l=0,g=0,d=0,h=0,f=0;a.each(n,function(e){var r=e[c],a=e.data;g+=r,f++;var n=a[o],p=t.checkArray(n,s),m=t.checkArray(n,i);p?(d++,u+=r):m&&(h++,l+=r)}),(2>=d||2>=h)&&(t.scoreData.errorMessage=this.msgMan.getMessage("notEnough")),0!==d&&(u/=d),0!==h&&(l/=h),e.avgCon1=u,e.avgCon2=l,e.diff=e.avgCon1-e.avgCon2,0!==f&&(e.avgBoth=g/f),t.addPenalty(e,r)},checkArray:function(e,r){for(var a=0;a<r.length;a++){var t=r[a];if(t==e)return!0}return!1},varianceAll:function(e){var r=this;a.each(r.parcelArray,function(a){r.varianceParcel(a,e)})},varianceParcel:function(e,r){var t=this,n=r.AnalyzedVar,o=e.trialIData,s=r.cond1VarValues,i=r.cond2VarValues,c=r.condVar,u=e.avgBoth,l=0,g=0,d=[],h=[],f=[],p=r.errorLatency,m=p.useForSTD;a.each(o,function(e){var a=e.data,o=e[n],u=r.ErrorVar,l=a[u],g=a[c],f=t.checkArray(g,s),p=t.checkArray(g,i);f?m?d.push(o):"0"==l&&d.push(o):p&&(m?h.push(o):"0"==l&&d.push(o))}),f=d.concat(h),a.each(f,function(e){var r=e;l=r-u,g+=l*l}),e.variance=g/(f.length-1)},scoreAll:function(e){var r=this,t=0;a.each(r.parcelArray,function(a){r.scoreParcel(a,e),t+=a.score});var n=t/r.parcelArray.length;r.scoreData.score=n.toFixed(2)},scoreParcel:function(e){var r=this,a=Math.sqrt(e.variance);0===a?(r.scoreData.errorMessage=this.msgMan.getMessage("notEnough"),e.score=e.diff):e.score=e.diff/a}}),r}),define("utils/post",[],function(){function e(e,a){return new Promise(function(t,n){var o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),o.onreadystatechange=function(){4===this.readyState&&(this.status>=200&&this.status<400?t(this.responseText):n(new Error("Failed posting to: "+e)))},o.send(r(a))})}function r(e){return"string"==typeof e?e:JSON.stringify(e)}return e}),define("pipScorer/Scorer",["require","./computeD","./msgMan","./parcelMng","underscore","utils/post"],function(e){function r(){this.computeData=new a,this.msgMan=new t,this.parcelMng=new n(this.msgMan)}var a=e("./computeD"),t=e("./msgMan"),n=e("./parcelMng"),o=e("underscore"),s=e("utils/post");return window.console||(window.console={log:o.noop,error:o.noop}),o.assign(r.prototype,{addSettings:function(e,r){switch(e){case"compute":this.computeData.setComputeObject(r);break;case"message":this.msgMan.setMsgObject(r);break;default:throw new Error('SCORER:addSettings: unknow "type" '+e)}},computeD:function(){var e=this.computeData,r=this.parcelMng;e.setDataArray(),r.Init(e),r.avgAll(e),r.varianceAll(e),r.scoreAll(e);var a=r.scoreData;return void 0===a.errorMessage||null===a.errorMessage?{FBMsg:this.getFBMsg(a.score),DScore:a.score,error:!1}:{FBMsg:a.errorMessage,DScore:"",error:!0}},postToServer:function(e,r,a,t){var n=this.computeData.postSettings||{},o=n.url,i={};return a||(a=n.score),t||(t=n.msg),i[a]=e,i[t]=r,s(o,JSON.stringify(i))},dynamicPost:function(e){var r=this.computeData.postSettings||{},a=r.url;return s(a,JSON.stringify(e))},getFBMsg:function(e){var r=this.msgMan.getScoreMsg(e);return r}}),r}),define("pipScorer",["pipScorer/Scorer"],function(e){return e});