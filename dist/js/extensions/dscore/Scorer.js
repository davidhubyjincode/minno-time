define("pipScorer/computeD",["require","underscore"],function(r){function e(){a.assign(this,{dataArray:{},AnalyzedVar:"latency",ErrorVar:"error",condVar:"",cond1VarValues:[],cond2VarValues:[],parcelVar:"",parcelValue:[],fastRT:300,maxFastTrialsRate:.1,minRT:400,maxRT:1e4,maxErrorParcelRate:.4,errorLatency:{use:"latency",penalty:600,useForSTD:!0},postSettings:{}})}var a=r("underscore");return a.assign(e.prototype,{setComputeObject:function(r){a.assign(this,r)},setDataArray:function(){var r=window.piGlobal;this.dataArray=r.current.logs}}),e}),define("pipScorer/msgMan",["require","underscore"],function(r){function e(){this.messages=a.extend({},t)}var a=r("underscore"),t={MessageDef:[],manyErrors:"There were too many errors made to determine a result.",tooFast:"There were too many fast trials to determine a result.",notEnough:"There were not enough trials to determine a result."};return a.extend(e.prototype,{setMsgObject:function(r){a.extend(this.messages,r)},getScoreMsg:function(r){var e=this.messages.MessageDef;if(Array.isArray(e)||!e.length)throw new Error('You must define a "MessageDef" array.');var t=parseFloat(r),n=null,s=null,o="error: msg was not set",c=!1;if(a.each(e,function(r){n=parseFloat(r.cut),s=r.message,n>=t&&!c&&(o=s,c=!0)}),!c){var i=e.length,u=e[i-1];o=u.message}return o},getMessage:function(r){return this.messages[r]}}),e}),define("pipScorer/parcelMng",["require","underscore"],function(r){function e(r){this.parcelArray=[],this.scoreData={},this.msgMan=r}var a=r("underscore");return a.extend(e.prototype,{Init:function(r){var e=this,t=this.msgMan,n=window.piGlobal,s=n.current.logs;e.parcelArray=[],e.scoreData={},e.msgMan=t;var o=r.AnalyzedVar,c=r.ErrorVar,i=r.parcelVar,u=r.parcelValue,l=r.minRT,g=r.maxRT,h=r.fastRT,p=0,f=0,d=0,v=0,y=parseFloat(r.maxFastTrialsRate);if("undefined"==typeof u||0===u.length){d=0,p=0,f=0,v=0;var m={};m.name="general",m.trialIData=[],a.each(s,function(a){a[o]>=l&&a[o]<=g?(d++,1==a.data[c]&&v++,e.validate(m,a,r)&&p++):a[o]<=h&&f++}),e.checkErrors(d,v,r),e.parcelArray[0]=m}else a.each(u,function(t,n){d=0,p=0,f=0,v=0;var u={};u.name=t,u.trialIData=[],a.each(s,function(a){var n=a.data[i];n==t&&(a[o]>=l&&a[o]<=g?(d++,1==a.data[c]&&v++,e.validate(u,a,r)&&p++):a[o]<=h&&f++)}),e.checkErrors(d,v,r),e.parcelArray[n]=u});f/p>y&&(e.scoreData.errorMessage=this.msgMan.getMessage("tooFast"))},checkErrors:function(r,e,a){var t=a.maxErrorParcelRate;e/r>t&&(this.scoreData.errorMessage=this.msgMan.getMessage("manyErrors"))},validate:function(r,e,a){var t=a.errorLatency,n=a.ErrorVar,s=e.data;return"latency"==t.use?(r.trialIData.push(e),!0):"false"==t.use?"1"==s[n]?!1:(r.trialIData.push(e),!0):"penalty"==t.use?(r.trialIData.push(e),!0):void 0},addPenalty:function(r,e){var t=e.errorLatency,n=this;if("penalty"==t.use){var s=parseFloat(t.penalty),o=e.ErrorVar,c=e.AnalyzedVar,i=e.condVar,u=e.cond1VarValues,l=e.cond2VarValues,g=r.trialIData,h=r.avgCon1,p=r.avgCon2;a.each(g,function(r){var e=r.data,a=e[o],t=e[i],g=n.checkArray(t,u),f=n.checkArray(t,l);"1"==a&&(g?r[c]+=h+s:f&&(r[c]+=p+s))})}},avgAll:function(r){var e=this;a.each(e.parcelArray,function(a){e.avgParcel(a,r)})},avgParcel:function(r,e){var t=this,n=r.trialIData,s=e.condVar,o=e.cond1VarValues,c=e.cond2VarValues,i=e.AnalyzedVar,u=0,l=0,g=0,h=0,p=0,f=0;a.each(n,function(r){var e=r[i],a=r.data;g+=e,f++;var n=a[s],d=t.checkArray(n,o),v=t.checkArray(n,c);d?(h++,u+=e):v&&(p++,l+=e)}),(2>=h||2>=p)&&(t.scoreData.errorMessage=this.msgMan.getMessage("notEnough")),0!==h&&(u/=h),0!==p&&(l/=p),r.avgCon1=u,r.avgCon2=l,r.diff=r.avgCon1-r.avgCon2,0!==f&&(r.avgBoth=g/f),t.addPenalty(r,e)},checkArray:function(r,e){for(var a=0;a<e.length;a++){var t=e[a];if(t==r)return!0}return!1},varianceAll:function(r){var e=this;a.each(e.parcelArray,function(a){e.varianceParcel(a,r)})},varianceParcel:function(r,e){var t=this,n=e.AnalyzedVar,s=r.trialIData,o=e.cond1VarValues,c=e.cond2VarValues,i=e.condVar,u=r.avgBoth,l=0,g=0,h=[],p=[],f=[],d=e.errorLatency,v=d.useForSTD;a.each(s,function(r){var a=r.data,s=r[n],u=e.ErrorVar,l=a[u],g=a[i],f=t.checkArray(g,o),d=t.checkArray(g,c);f?v?h.push(s):"0"==l&&h.push(s):d&&(v?p.push(s):"0"==l&&h.push(s))}),f=h.concat(p),a.each(f,function(r){var e=r;l=e-u,g+=l*l}),r.variance=g/(f.length-1)},scoreAll:function(r){var e=this,t=0;a.each(e.parcelArray,function(a){e.scoreParcel(a,r),t+=a.score});var n=t/e.parcelArray.length;e.scoreData.score=n.toFixed(2)},scoreParcel:function(r){var e=this,a=Math.sqrt(r.variance);0===a?(e.scoreData.errorMessage=this.msgMan.getMessage("notEnough"),r.score=r.diff):r.score=r.diff/a}}),e}),define("utils/post",[],function(){function r(r,a){return new Promise(function(t,n){var s=new XMLHttpRequest;s.open("POST",r,!0),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.onreadystatechange=function(){4===this.readyState&&(this.status>=200&&this.status<400?t(this.responseText):n(new Error("Failed posting to: "+r)))},s.send(e(a))})}function e(r){return"string"==typeof r?r:JSON.stringify(r)}return r}),define("pipScorer/Scorer",["require","./computeD","./msgMan","./parcelMng","underscore","utils/post"],function(r){function e(){this.computeData=new a,this.msgMan=new t,this.parcelMng=new n(this.msgMan)}var a=r("./computeD"),t=r("./msgMan"),n=r("./parcelMng"),s=r("underscore"),o=r("utils/post");return s.assign(e.prototype,{addSettings:function(r,e){switch(r){case"compute":this.computeData.setComputeObject(e);break;case"message":this.msgMan.setMsgObject(e);break;default:throw new Error('SCORER:addSettings: unknow "type" '+r)}},computeD:function(){var r=this.computeData,e=this.parcelMng;r.setDataArray(),e.Init(r),e.avgAll(r),e.varianceAll(r),e.scoreAll(r);var a=e.scoreData;return void 0===a.errorMessage||null===a.errorMessage?{FBMsg:this.getFBMsg(a.score),DScore:a.score,error:!1}:{FBMsg:a.errorMessage,DScore:"",error:!0}},postToServer:function(r,e,a,t){var n=this.computeData.postSettings||{},s=n.url,c={};return a||(a=n.score),t||(t=n.msg),c[a]=r,c[t]=e,o(s,JSON.stringify(c))},dynamicPost:function(r){var e=this.computeData.postSettings||{},a=e.url;return o(a,JSON.stringify(r))},getFBMsg:function(r){var e=this.msgMan.getScoreMsg(r);return e}}),e}),define("pipScorer",["pipScorer/Scorer"],function(r){return r});