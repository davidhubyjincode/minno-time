{"version":3,"file":"time.js","sources":["../src/utils/polyfills.js","../src/app/task/script.js","../src/app/global.js","../src/app/sequencer/sequenceGoto.js","../src/app/task/parser.js","../src/app/task/getSize.js","../src/app/task/adjust_canvas.js","../src/app/task/applyCanvasStyles.js","../node_modules/css/css.js","../src/app/task/canvasSetup.js","../src/app/task/settings.js","../src/app/sequencer/buildUrl.js","../src/app/sequencer/sequencePreload.js","../src/app/preloadPhase.js","../src/app/trial/input/bindings/mouseEvents.js","../src/app/trial/input/bindings/keypressed.js","../src/app/trial/input/bindings/keyup.js","../src/app/trial/input/bindings/simpleRandomize.js","../src/app/trial/input/bindings/timeout.js","../src/app/trial/input/binder.js","../src/app/trial/input/createListener.js","../src/app/trial/input/input.js","../src/app/trial/stimulus/getMedia.js","../src/app/trial/stimulus/setSize.js","../src/app/trial/stimulus/setPlace.js","../src/app/trial/stimulus/Stimulus.js","../src/app/trial/stimulus/stimulusCollection.js","../src/app/trial/evaluate.js","../src/app/trial/action.js","../src/app/trial/interactions.js","../src/app/trial/Trial.js","../src/app/sequencer/nextTrial.js","../src/app/task/logger/post.js","../src/app/task/logger/poster.js","../src/app/task/logger/transformLogs.js","../src/app/task/logger/createLogs.js","../src/app/playPhase.js","../src/index.js","../node_modules/mithril-stream/stream.js","../src/app/sequencer/preloader.js","../node_modules/fastdom/fastdom.js","../src/app/trial/input/now.js","../src/app/trial/actionList.js"],"sourcesContent":["if (!Date.now) Date.now = function() { return new Date().getTime(); };\n\nfunction log(){ console.log.apply(console, arguments); }\nif (!console.group) console.group = log;\nif (!console.groupCollapsed) console.groupCollapsed = log;\nif (!console.groupEnd) console.groupEnd = log;\nif (!console.table) console.table = log;\n\n\n(function() {\n    'use strict';\n\n    var vendors = ['webkit', 'moz'];\n    for (var i = 0; i < vendors.length && !window.requestAnimationFrame; ++i) {\n        var vp = vendors[i];\n        window.requestAnimationFrame = window[vp+'RequestAnimationFrame'];\n        window.cancelAnimationFrame = (window[vp+'CancelAnimationFrame']\n            || window[vp+'CancelRequestAnimationFrame']);\n    }\n    // iOS6 is buggy\n    if (/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent) || !window.requestAnimationFrame || !window.cancelAnimationFrame) {\n        var lastTime = 0;\n        window.requestAnimationFrame = function(callback) {\n            var now = Date.now();\n            var nextTime = Math.max(lastTime + 16, now);\n            return setTimeout(function() { callback(lastTime = nextTime); },\n                              nextTime - now);\n        };\n        window.cancelAnimationFrame = clearTimeout;\n    }\n}());\n\n// Promise polyfill from https://github.com/MithrilJS/mithril.js/blob/next/promise/promise.js \n\"use strict\"\n/** @constructor */\nvar PromisePolyfill = function(executor) {\n    if (!(this instanceof PromisePolyfill)) throw new Error(\"Promise must be called with `new`\")\n        if (typeof executor !== \"function\") throw new TypeError(\"executor must be a function\")\n\n            var self = this, resolvers = [], rejectors = [], resolveCurrent = handler(resolvers, true), rejectCurrent = handler(rejectors, false)\n            var instance = self._instance = {resolvers: resolvers, rejectors: rejectors}\n            var callAsync = typeof setImmediate === \"function\" ? setImmediate : setTimeout\n            function handler(list, shouldAbsorb) {\n                return function execute(value) {\n                    var then\n                    try {\n                        if (shouldAbsorb && value != null && (typeof value === \"object\" || typeof value === \"function\") && typeof (then = value.then) === \"function\") {\n                            if (value === self) throw new TypeError(\"Promise can't be resolved w/ itself\")\n                                executeOnce(then.bind(value))\n                        }\n                        else {\n                            callAsync(function() {\n                                if (!shouldAbsorb && list.length === 0) console.error(\"Possible unhandled promise rejection:\", value)\n                                    for (var i = 0; i < list.length; i++) list[i](value)\n                                        resolvers.length = 0, rejectors.length = 0\n                                instance.state = shouldAbsorb\n                                instance.retry = function() {execute(value)}\n                            })\n                        }\n                    }\n                    catch (e) {\n                        rejectCurrent(e)\n                    }\n                }\n            }\n            function executeOnce(then) {\n                var runs = 0\n                function run(fn) {\n                    return function(value) {\n                        if (runs++ > 0) return\n                        fn(value)\n                    }\n                }\n                var onerror = run(rejectCurrent)\n                try {then(run(resolveCurrent), onerror)} catch (e) {onerror(e)}\n            }\n\n            executeOnce(executor)\n}\nPromisePolyfill.prototype.then = function(onFulfilled, onRejection) {\n    var self = this, instance = self._instance\n    function handle(callback, list, next, state) {\n        list.push(function(value) {\n            if (typeof callback !== \"function\") next(value)\n                else try {resolveNext(callback(value))} catch (e) {if (rejectNext) rejectNext(e)}\n        })\n        if (typeof instance.retry === \"function\" && state === instance.state) instance.retry()\n    }\nvar resolveNext, rejectNext\nvar promise = new PromisePolyfill(function(resolve, reject) {resolveNext = resolve, rejectNext = reject})\nhandle(onFulfilled, instance.resolvers, resolveNext, true), handle(onRejection, instance.rejectors, rejectNext, false)\nreturn promise\n}\nPromisePolyfill.prototype.catch = function(onRejection) {\n    return this.then(null, onRejection)\n}\nPromisePolyfill.resolve = function(value) {\n    if (value instanceof PromisePolyfill) return value\n    return new PromisePolyfill(function(resolve) {resolve(value)})\n}\nPromisePolyfill.reject = function(value) {\n    return new PromisePolyfill(function(resolve, reject) {reject(value)})\n}\nPromisePolyfill.all = function(list) {\n    return new PromisePolyfill(function(resolve, reject) {\n        var total = list.length, count = 0, values = []\n        if (list.length === 0) resolve([])\n            else for (var i = 0; i < list.length; i++) {\n                (function(i) {\n                    function consume(value) {\n                        count++\n                            values[i] = value\n                            if (count === total) resolve(values)\n                    }\n                if (list[i] != null && (typeof list[i] === \"object\" || typeof list[i] === \"function\") && typeof list[i].then === \"function\") {\n                    list[i].then(consume, reject)\n                }\n                else consume(list[i])\n                })(i)\n            }\n    })\n}\nPromisePolyfill.race = function(list) {\n    return new PromisePolyfill(function(resolve, reject) {\n        for (var i = 0; i < list.length; i++) {\n            list[i].then(resolve, reject)\n        }\n    })\n}\n\nif (typeof window.Promise === \"undefined\") window.Promise = PromisePolyfill\n","/*\n * this file holds the script we are to run\n */\n\nexport default script;\n\nvar scriptObj = {};\n\n/**\n * Getter/Setter fo script\n *\n * @param  {Object || null} obj \tThe new script, if it is not set this is simply a getter.\n * @return {Object}     \t\t\tThe full script\n */\nfunction script(obj){\n    obj && (scriptObj = obj);\n    return scriptObj;\n}\n","import _ from 'lodash';\nexport default global;\n\n// initiate piGloabl\nvar glob = window.piGlobal || (window.piGlobal = {});\n\n/**\n * getter setter for the global object\n * @param  {Object} obj     The object to add to the global\n * @param  {Bool} \treplace A new object to fully replace the old global\n * @return {Object}         The full global\n */\nfunction global(obj, replace){\n\n    if (replace) {\n        glob = obj;\n        return glob;\n    }\n\n    if (_.isPlainObject(obj)){\n        _.each(function(value, key){\n            /* eslint-disable no-console */\n            console.warn && global[key] && console.warn('Overwriting \"' + key  + '\" in global object.');\n            /* eslint-enable no-console */\n        });\n        _.merge(glob, obj);\n    }\n\n    return glob;\n}\n\n","/**\n * Go to a destination within the sequence (must be a property of a sequence)\n * @param  {String} target destination type\n * @param  {Object} properties destination options\n * @return {Object}        result element\n */\n\nimport _ from 'lodash';\nexport default go;\n\nfunction go(destination, properties, context){\n    var mixerSequence = this.mixerSequence;\n\n    switch (destination){\n        case 'nextWhere':\n            where('next', properties, context, mixerSequence);\n            break;\n        case 'previousWhere':\n            where('next', properties, context, mixerSequence);\n            break;\n        case 'current':\n            // don't need to do anything...\n            break;\n        case 'first':\n            do {mixerSequence.prev(context);} while (mixerSequence.current(context));\n            break;\n        case 'last':\n            do {mixerSequence.next(context);} while (mixerSequence.current(context));\n            mixerSequence.prev();\n            break;\n        case 'end':\n            do {mixerSequence.next(context);} while (mixerSequence.current(context));\n            break;\n        case 'next' :\n            mixerSequence.next(context); // get the next trial, in case there are no more trials, returns undefined\n            break;\n        default:\n            throw new Error('Unknow destination \"' + destination + '\" for goto.');\n    }\n\n    return this;\n}\n\nfunction where(direction, properties, context, sequence){\n    var curr;\n\n    do {\n        sequence[direction]();\n        curr = sequence.current(context);\n    } while (curr && !_.callback(properties)(curr.data));\n}\n","/*\n * this file is resposible for taking the experiment script (json) and parsing it\n */\n\n// load dependancies\nimport _ from 'lodash';\nimport Database from 'minno-sequencer';\nimport go from '../sequencer/sequenceGoto';\n\nexport default parser;\n\nfunction parser(script){\n    var db = new Database();\n    db.createColl('trial');\n    db.createColl('stimulus');\n    db.createColl('media');\n\n    db.add('trial', script.trialSets || []);\n    db.add('stimulus', script.stimulusSets || []);\n    db.add('media', script.mediaSets || []);\n\n    if (!_.isArray(script.sequence)) throw new Error('You must set a sequence array.');\n\n    var sequence = db.sequence('trial', script.sequence);\n    sequence.go = go; // see sequence/goto.js to understand why we are doing this\n    db.currentSequence = sequence;\n    return db;\n}\n","export default getSize;\n\n// helper function: returns sizes of element;\nfunction getSize(el){\n    var computedStyle = window.getComputedStyle(el);\n    return {\n        height    : parse(el.offsetHeight) - parse(computedStyle.borderTopWidth) - parse(computedStyle.borderBottomWidth),\n        width    : parse(el.offsetWidth) - parse(computedStyle.borderLeftWidth) - parse(computedStyle.borderRightWidth)\n    };\n}\n\nfunction parse(num){ return parseFloat(num, 10) || 0;}\n","/*\n * adjust canvas according to window size and settings\n * this module is built to be part of the main view\n */\n\nimport _ from 'lodash';\nimport getSize from './getSize';\n\nexport default adjust_canvas;\n\n// the function to be used by the main view\nfunction adjust_canvas(canvas, settings){\n\n    return _.throttle(eventListener, 16);\n\n    function eventListener(event){\n        // we put this in a time out because of a latency of orientation change on android devices\n        if (event.type == 'orientationchange') setTimeout(resize, 500);\n        else resize();\n    }\n\n    function resize(){\n        var targetSize = getTargetSize(settings, canvas);\n\n        // remove border width and top margin from calculated width (can't depend on cool box styles yet...)\n        // we compute only margin-top because of a difference calculating margins between chrome + IE and firefox + mobile\n        var computedStyle = window.getComputedStyle(canvas);\n        targetSize.height -= parse(computedStyle.borderTopWidth) + parse(computedStyle.borderBottomWidth) + parse(computedStyle.marginTop);\n        targetSize.width -= parse(computedStyle.borderLeftWidth) + parse(computedStyle.borderRightWidth);\n\n        // reset canvas size\n        canvas.style.width = targetSize.width + 'px';\n        canvas.style.height = targetSize.height + 'px';\n        canvas.style.fontSize = targetSize.height*(settings.textSize || 3)/100 + 'px';\n\n        // scroll to top of window (hides some of the mess on the top of mobile devices)\n        window.scrollTo(0, 1);\n    }\n}\n\nfunction getProportions(settings){\n    // if proportions are an object they should include width and height\n    if (_.isPlainObject(settings.proportions)) {\n        if (typeof settings.proportions.height !== 'number' || typeof settings.proportions.width !== 'number'){\n            throw new Error('The canvas proportions object`s height and a width properties must be numeric');\n        }\n        return settings.proportions.height/settings.proportions.width; \n    } \n    return settings.proportions || 0.8; // by default proportions are 0.8\n}\n\nfunction getTargetSize(settings, canvas){\n    // calculate proportions (as height/width)\n    var proportions = getProportions(settings);\n\n    // static canvas size\n    // ------------------\n    if (settings.width) return {\n        width: settings.width,\n        height: settings.width*proportions\n    };\n\n    // dynamic canvas size\n    // -------------------\n\n    var docElement = window.document.documentElement; // used to get client view size\n\n    var maxHeight = docElement.clientHeight;\n    var maxWidth = Math.min(settings.maxWidth, docElement.clientWidth, getSize(canvas.parentNode).width);\n\n    // calculate the correct size for this screen size\n    if (maxHeight > proportions * maxWidth) return { height: maxWidth*proportions, width: maxWidth };\n    else return { height: maxHeight, width: maxHeight/proportions};\n}\n\nfunction parse(num){ return parseFloat(num, 10) || 0;}\n","/**\n *\n * This whole module taken from piManager\n *\n */\n\nimport _ from 'lodash';\nexport default canvasContructor;\n\n/**\n * Takes a map of css rules and applies them.\n * Returns a function that returns the page to its former condition.\n *\n * The rule map is an object of ruleName -> ruleObject.\n *\n * var ruleObject = {\n * \telement : wrapped element to affect\n * \tproperty: css property to modify\n * }\n *\n * @param  {Object} map      A hash of rules.\n * @param  {Object} settings A hash of ruleName -> value\n * @return {Function}        A function that undoes all the previous changes\n */\nfunction canvasContructor(map, settings){\n    var offArr;\n\n    if (!_.isPlainObject(map)) throw new Error('canvas(map): You must set a rule map for canvas to work properly');\n\n    // if settings is undefined return a function that doesn't do anything\n    // just so we don't need to make sure that the user modifies the canvas\n    if (_.isUndefined(settings)) return _.noop;\n    if (!_.isPlainObject(settings)) throw new Error('canvas(settings): canvas settings must be an object');\n\n    // create an array of off functions to undo any changes by this action\n    offArr = _.map(settings, function(value,key){\n        var rule = map[key];\n        if (rule) return on(rule.element, rule.property, value);\n        throw new Error('canvas('+ key +'): unknow key in canvas object.');\n    });\n\n    return function off(){\n        _.forEach(offArr, function(fn){fn.call();});\n    };\n}\n\nfunction on(el, property, value){\n    var old = el.style[property]; // save old value\n    el.style[property] = value; // set new value\n    return function(){el.style[property] = old;};  // create off function\n}\n\n","export default css;\n\nfunction css(el, obj){\n    var style = el.style;\n\n    if (!obj) return;\n\n    for (var key in obj) style[camelCase(key)] = obj[key];\n\n    function camelCase(str){ \n        return  str.replace(/-([a-z])/g, function (g) { return g[1].toUpperCase(); }); \n    }\n}\n","import _ from 'lodash';\nimport adjustCanvas from './adjust_canvas';\nimport applyCanvasStyles from './applyCanvasStyles';\nimport stream from 'mithril-stream';\nimport css from 'css';\n\nexport default setupCanvas;\n\nfunction setupCanvas(canvas, script){\n    var canvasSettings = _.get(script, 'settings.canvas', {});\n    var $resize = stream();\n\n    canvas.classList.add('minno-canvas');\n\n    $resize.map(adjustCanvas(canvas, canvasSettings));\n    $resize({});\n\n    window.addEventListener('orientationchange', $resize);\n    window.addEventListener('resize', $resize);\n\n\n\n    var map = {\n        background \t\t\t: {element: document.body, property: 'backgroundColor'},\n        canvasBackground\t: {element: canvas, property:'backgroundColor'},\n        borderColor\t\t\t: {element: canvas, property:'borderColor'},\n        borderWidth\t\t\t: {element: canvas, property:'borderWidth'}\n    };\n\n    // settings activator\n    var off = applyCanvasStyles(map, _.pick(canvasSettings,['background','canvasBackground','borderColor','borderWidth']));\n\n    canvasSettings.css && css(canvas, canvasSettings.css);\n\n    $resize.end\n        .map(function(){canvas.classList.remove('minno-canvas');})\n        .map(removeListeners)\n        .map(off);\n\n    return $resize;\n\n    function removeListeners(){\n        window.removeEventListener('orientationchange',$resize);\n        window.removeEventListener('resize', $resize);\n    }\n}\n","/*\n * simply take settings out of the script\n */\n\nimport script from './script';\nexport default settingsGetter;\n\n/**\n * get settings from script\n * @param  {String} name  \t\tOptional name of specific setting to get\n * @return {*}         \t\t\tThe settings object (or a sub of it)\n */\nfunction settingsGetter(name){\n    var settings = script().settings || {};\n\n    if (name) return settings[name];\n    return settings;\n}\n\n","/*\n * build the url for this src (add the generic base_url)\n */\n\nimport _ from 'lodash';\nimport settingsGetter from '../task/settings';\n\nexport default buildUrl;\n\nfunction buildUrl(url, type){\n    var settings = settingsGetter();\n    var base_url;\n\n    // the base url setting may be either a string, or an object with the type as a field\n    if (_.isString(settings.base_url)) {\n        base_url = settings.base_url;\n    } else {\n        if (_.isObject(settings.base_url)) {\n            base_url = settings.base_url[type];\n        }\n    }\n\n    // it this is a dataUrl type of image, we don't need to append the baseurl\n    if (type == 'image' && /^data:image/.test(url)){\n        return url;\n    }\n\n    // make sure base url is set, and add trailing slash if needed\n    if (!base_url) {\n        base_url='';\n    } else {\n        if (base_url[base_url.length-1] != '/') {\n            base_url+='/';\n        }\n    }\n\n    return base_url + url;\n}\n","/*\n * gets all media that needs preloading and preloads it\n */\n\nimport _ from 'lodash';\nimport preloader from './preloader';\nimport buildUrl from './buildUrl';\n\nexport default sequencePreload;\n\nfunction loadMedia(media){\n    if (!_.isUndefined(media.image)) preloader.load(buildUrl(media.image, 'image'),'image');\n    if (!_.isUndefined(media.template)) preloader.load(buildUrl(media.template,'template'),'template');\n}\n\nfunction loadStimulus(stimulus) {\n    if (stimulus.media) loadMedia(stimulus.media);\n}\n\nfunction loadInput(input){\n    if (input.element) loadMedia(input.element);\n}\n\nfunction loadTrial(trial){\n    _.each(trial.layout || [], loadStimulus);\n    _.each(trial.stimuli || [], loadStimulus);\n    _.each(trial.input || [], loadInput);\n}\n\n// load trials in sequence (essentialy, recursively pick out the trials out of the mixer)\nfunction loadSequence (sequence){\n    _.each(sequence,function(element){\n        if (!_.isUndefined(element.mixer)) loadSequence(element.data);\n        else loadTrial(element);\n    });\n}\n\nfunction loadScript(script){\n    // load media sets\n    _.each(script.mediaSets || [], loadMedia);\n\n    // load stimsets\n    _.each(script.stimulusSets || [], loadStimulus);\n\n    // load trialsets\n    _.each(script.trialSets || [], loadTrial);\n\n    loadSequence(script.sequence);\n} // load script\n\n// accepts a piece of script and a type\n// @param script: a piece of script\n// @param type: what sort of object this is (media/stimulus/trial)\n// @param reset: should we reset the preloader before activating it (use if for some reason we lost the cache...)\n// @returns a deferred object\nfunction sequencePreload (script, type, reset){\n    if (reset) preloader.reset();\n\n    switch (type){\n        case 'media'\t: loadMedia(script); break;\n        case 'stimulus'\t: loadStimulus(script); break;\n        case 'trial'\t: loadTrial(script); break;\n        case 'script'\t:\n            /* falls through */\n        default:\n            loadScript(script); break;\n    }\n    return preloader;\n}\n","import preload from './sequencer/sequencePreload';\nimport fastdom from 'fastdom';\n\nexport default preloadPhase;\n\nfunction preloadPhase(canvas, script){\n    var preloader = preload(script);\n\n    if (preloader.progress() == 1) return Promise.resolve().then(emptyCanvas);\n\n    canvas.innerHTML = '<div class=\"minno-progress\"><div class=\"minno-progress-bar\"></div></div>';\n\n    var barStyle = canvas.getElementsByClassName('minno-progress-bar')[0].style;\n    barStyle.width = preloader.progress() + '%';\n    preloader.onload = function(){\n        fastdom.mutate(function(){\n            barStyle.width = preloader.progress()*100 + '%';\n        });\n    };\n\n    return preloader.all()\n        .then(emptyCanvas)['catch'](function(src){\n            throw new Error('loading resource failed, do something about it! (you can start by checking the error log, you are probably reffering to the wrong url - ' + src +')');\n        });\n\n    function emptyCanvas(){\n        while (canvas.firstChild) canvas.removeChild(canvas.firstChild);\n    }\n}\n\n","import css from 'css';\nimport fastdom from 'fastdom';\n\nexport default mouseEvents;\n\nfunction mouseEvents(eventName, $listener,inputObj, canvas){\n    var element = inputObj.element;\n\n    if (element){\n        css(element, inputObj.css);\n        fastdom.mutate(function(){\n            canvas.appendChild(element);\n        });\n    }\n\n    canvas.addEventListener(eventName, clickListener);\n\n    $listener.end.map(removeClickListener);\n    return $listener;\n\n    function clickListener(e){\n        var target = e.target;\n        if (element && target === element) return $listener(e);\n        if (!element && target.getAttribute('data-handle') === inputObj.stimHandle) return $listener(e);\n        return;\n    }\n\n    function removeClickListener(){\n        if (element) canvas.removeChild(element);\n        canvas.removeEventListener(eventName, $listener);\n    }\n}\n","/*\n* key pressed listener\n* reqires key\n*\n* key can be either charCode or string.\n* or an array of charCode/strings.\n*/\n\n// we monitor all key up events so that we trigger only once per key down\nexport default keypressed;\n\nvar keyDownArr = [];\n\ndocument.addEventListener('keyup',function(e){ keyDownArr[e.which] = false; });// unset flag to prevent multi pressing of a key \n\nfunction keypressed($listener,inputObj){\n    // make sure key is an array\n    var keys = Array.isArray(inputObj.key) ? inputObj.key : [inputObj.key];\n\n    // map keys to keyCodes\n    var target = keys.map(function(value){ \n        return typeof value == 'string' ? value.toUpperCase().charCodeAt(0) : value; \n    });\n\n    document.addEventListener('keydown', keypressListener);\n\n    $listener.end.map(removeKeypressListener);\n    return $listener;\n\n    function keypressListener(e){\n        if (keyDownArr[e.which] || (target.indexOf(e.which) === -1)) return;\n        e.preventDefault(); // prevent FF from wasting about 10ms in browser-content.js (and fast search)\n        keyDownArr[e.which] = true; // set flag to prevent multi pressing of a key\n        $listener(e);\n    }\n\n    function removeKeypressListener(){\n        document.removeEventListener('keydown', keypressListener);\n    }\n}\n","export default keyup; \n\nfunction keyup($listener,inputObj){\n    // make sure key is array\n    var keys = Array.isArray(inputObj.key) ? inputObj.key : [inputObj.key];\n\n    // map keys to keyCodes\n    var target = keys.map(function(value){ \n        return typeof value == 'string' ? value.toUpperCase().charCodeAt(0) : value; \n    });\n\n    document.addEventListener('keyup', keypressListener);\n\n    $listener.end.map(removeKeypressListener);\n    return $listener;\n\n    function keypressListener(e){\n        if (target.indexOf(e.which) === -1) return;\n        e.preventDefault();\n        return $listener(e);\n    }\n\n    function removeKeypressListener(){\n        document.removeEventListener('keyup', $listener);\n    }\n}\n","/**\n *\tTakes a properties objects and returns the result of a randomization:\n *\tIf it is an array - pick a random member\n *\tIf it is an object pick from within a range\n *\tIf it is a function return its result using the context\n *\tOtherwise simply return the properties\n */\nimport _ from 'lodash';\n\nexport default simpleRandomize;\n\nfunction simpleRandomize(properties, context){\n\n    if (_.isArray(properties)) {\n        var index = Math.floor(Math.random()*properties.length);\n        return properties[index];\n    }\n\n    if (_.isFunction(properties)) {\n        return properties.call(context);\n    }\n\n    // this must be after the test for arrays and functions, because they are considered objects too\n    if (_.isPlainObject(properties)) {\n        if (!_.isNumber(properties.min) || !_.isNumber(properties.max) || properties.min > properties.max) {\n            throw new Error('randomization objects need both a max and a minimum property, also max has to be larger than min');\n        }\n        return properties.min + (properties.max - properties.min) * Math.random();\n    }\n\n    // if this is not a randomization object simply return\n    return properties;\n}\n\n","import randomize from './simpleRandomize';\n\nexport default timeout;\n\nfunction timeout($listener, inputObj){\n    var timeoutID;\n    var duration = randomize(inputObj.duration) || 0;\n\n    $listener.end.map(cancel);\n\n    if (duration) setTimeout($listener.bind(null, {}), duration);\n    else $listener({}); // listener is already registered with $events so this should be immidiate\n\n    return $listener;\n\n    function cancel(){\n        clearTimeout(timeoutID);\n    }\n}\n","\nimport _ from 'lodash';\nimport mouseEvents from './bindings/mouseEvents';\nimport keypressed from './bindings/keypressed';\nimport keyup from './bindings/keyup';\nimport timeout from './bindings/timeout';\nimport css from 'css';\n\nexport default inputBinder;\n\n/**\n * The input binder is a hash of default input types\n * It returns a stream of events\n **/\nfunction inputBinder($listener, inputObj, canvas){\n    var on = inputObj.on; // what type of binding is this?\n\n    switch (on){\n\n        case 'keypressed'\t: return keypressed($listener, inputObj);\n\n        case 'keyup'\t\t: return keyup($listener, inputObj);\n\n        case 'click'\t\t:\n        case 'mousedown'    :\n            return mouseEvents('mousedown', $listener,inputObj, canvas);\n\n        case 'mouseup'\t    : return mouseEvents('mouseup', $listener,inputObj);\n\n        case 'mouseenter'\t: return mouseEvents('mouseenter', $listener,inputObj);\n\n        case 'mouseleave'\t: return mouseEvents('mouseleave', $listener,inputObj);\n\n        case 'timeout'\t\t: return timeout($listener,inputObj);\n\n        /*\n         * Shortcuts\n         */\n\n        case 'enter'\t: return keypressed($listener, _.assign({key:13},inputObj));\n\n        case 'space'\t: return keypressed($listener, _.assign({key:32},inputObj));\n\n        case 'esc'\t    : return keypressed($listener, _.assign({key:27},inputObj));\n\n        case 'leftTouch'\t:\n            inputObj.element = createElement(inputObj.css, {\n                position: 'absolute',\n                left: 0,\n                width: '30%',\n                height: '100%',\n                background: '#00FF00',\n                opacity: 0.3\n            });\n\n            return mouseEvents('mousedown', $listener,inputObj);\n\n        case 'rightTouch'\t:\n            inputObj.element = createElement(inputObj.css, {\n                position: 'absolute',\n                right: 0,\n                width: '30%',\n                height: '100%',\n                background: '#00FF00',\n                opacity: 0.3\n            });\n\n            return mouseEvents('mousedown', $listener,inputObj);\n\n        case 'topTouch'\t:\n            inputObj.element = createElement(inputObj.css, {\n                position: 'absolute',\n                top: 0,\n                width: '100%',\n                height: '30%',\n                background: '#00FF00',\n                opacity: 0.3\n            });\n\n            return mouseEvents('mousedown', $listener,inputObj);\n\n        case 'bottomTouch'\t:\n            inputObj.element = createElement(inputObj.css, {\n                position: 'absolute',\n                bottom: 0,\n                width: '100%',\n                height: '30%',\n                background: '#00FF00',\n                opacity: 0.3\n            });\n\n            return mouseEvents('mousedown', $listener,inputObj);\n\n        default:\n            throw new Error('You have an input element without a recognized \"on\" property: ' + on);\n\n    }\n\n\n    function createElement(css2, css1){\n        var el = document.createElement('div');\n        css(el, css1);\n        css(el, css2);\n        return el;\n    }\n}\n","import binder from './binder';\nimport stream from 'mithril-stream';\nimport _ from 'lodash';\n\nexport default createListener;\n\nfunction createListener(inputObj,canvas){\n    // @TODO: this API is very confusing\n    // the binder MUST return the original stream ($listener)\n    // maybe we should simplify this, possibly instead of explicitly exposing streams, expose callbacks?\n    var $listener = stream();\n    $listener.handle = inputObj.handle;\n\n    if (_.isFunction(inputObj)) {\n        $listener = inputObj($listener, inputObj, canvas);\n        if (isStream($listener)) return $listener;\n        throw new Error('Input functions must return valid streams');\n    }\n\n    if (!_.isPlainObject(inputObj)) throw new Error('Input must only contain objects and functions, do you have an undefined value?');\n\n    if (_.isString(inputObj.on)) return binder($listener,inputObj,canvas); // must return $listener :(\n\n    if (_.isFunction(inputObj.on )) inputObj.on($listener, inputObj, canvas);\n    if (_.isFunction(inputObj.off)) $listener.end.map(inputObj.off);\n    return $listener;\n}\n\n\nfunction isStream(stream) {return stream._state; }\n","import createListener from './createListener';\nimport now from './now';\n\nexport default interfaceFn;\n\nfunction interfaceFn($events, trial){\n    var listenerStack = []; // holds all active listeners\n    var baseTime = 0;\n\n    return { add:add,remove:remove,destroy:destroy,resetTimer:resetTimer };\n\n    function add(inputObj){\n        if (!inputObj) throw new Error('Missing input element. Could not add input listener');\n        var stream = createListener(inputObj, trial.canvas);\n        stream.map(addDetails).map($events); // pipe events to $events\n        listenerStack.push(stream);\n\n        function addDetails(event){\n            return {\n                handle      : inputObj.handle,\n                event       : event,\n                trialId     : trial._id,\n                counter     : trial.counter,\n                timestamp\t: +new Date(),\n                latency\t\t: now() - baseTime\n            };\n        }\n    }\n\n    function remove(handle){\n        // go through the listener stack and remove any listeners that fit the handle\n        // note that we do this in reverse so that the index does not change\n        for (var i = listenerStack.length - 1; i >= 0 ; i--){\n            var listener = listenerStack[i];\n            if (listener.handle === handle){\n                listener.end(true);\n                listenerStack.splice(i,1);\n            }\n        }\n    }\n\n    function destroy(){\n        listenerStack.forEach(function(stream){\n            stream.end(true);\n        });\n        listenerStack.length = 0;\n    }\n\n    function resetTimer(){ baseTime = now(); }\n}\n","export default getMedia;\n\nfunction getMedia(media){\n    // all templateing is done within the inflate trial function and the sequencer\n    var template = media.html || media.inlineTemplate || media.template; // give inline template precedence over template, because tempaltes are loaded into inlinetemplate\n    var el;\n\n    if (media.word) {\n        el = document.createElement('div');\n        el.textContent = media.word;\n        return Promise.resolve(el);\n    }\n\n    if (media.image) {\n        // at this time, we count on the preloader to throw for errors\n        // the reject option isn't really being used here...\n        return new Promise(function(resolve, reject){\n            el = document.createElement('img');\n            el.onload = function(){resolve(el);};\n            el.onerror = function(){reject(new Error('Image not found: ' + el.src ));};\n            el.src = media.image;\n        });\n    }\n\n    if (media.jquery) Promise.reject(new Error('Jquery is no longer supported in minno-time'));\n\n    if (template) { // html | template | inlineTemplate\n        el = document.createElement('div');\n        el.innerHTML = template;\n        return Promise.resolve(el);\n    } \n\n    return Promise.reject(new Error('Unrecognized media type')); // this is not a supported html type\n}\n","export default setSize;\n\nfunction setSize(el, stimulus){\n    var style = el.style;\n    var size = stimulus.size || {};\n\n    if (size.font_size) style.fontSize = size.font_size;\n\n    // if this is a word, we don't want to set height (it breaks centering)\n    if (isSet('height', size) && !stimulus.media.word) style.height = size.height + '%';\n\n    if (isSet('width', size)) style.width = size.width + '%';\n\n    return el;\n}\n\nfunction isSet(prop, obj){return prop in obj;}\n","export default setPlace;\n\nfunction setPlace(el,stimulus){\n    var location = stimulus.location || {};\n\n    // set offsets:\n    if (location.top == 'center' || location.bottom == 'center' || (location.top === undefined && location.bottom === undefined)) el.classList.add('minno-stimulus-center-y');\n    if (location.left == 'center' || location.right == 'center' || (location.left === undefined && location.right === undefined)) el.classList.add('minno-stimulus-center-x');\n\n    ['top','bottom','left','right'].forEach(setNumericLocation);\n\n    function isNumeric(val) {return !isNaN(+val);}\n    function setNumericLocation(attr){ if (isNumeric(location[attr])) el.style[attr] = location[attr] + '%'; }\n}\n","import fastdom from 'fastdom';\nimport getMedia from './getMedia';\nimport setSize from './setSize';\nimport setPlace from './setPlace';\nimport css from 'css';\n\nexport default Stimulus;\n\nfunction Stimulus(stimulus, trial, canvas){\n    var self = {\n        el: null, // is set within init, some methods will break if not called before init...\n        source: stimulus,\n        trial: trial,\n        canvas: canvas,\n        init: init,\n        show: show,\n        hide: hide,\n        name: name,\n        mediaName: mediaName,\n        destroy: destroy\n    };\n\n    // make sure we have a data object\n    self.data = stimulus.data || {};\n\n    // set the handle\n    self.handle = self.data.handle = self.data.handle || stimulus.handle || stimulus.set;\n\n    return self;\n}\n\n\nfunction init(){\n    if (!this.source.media) throw new Error('Media object not defined for ' + this.name());\n\n    return getMedia(this.source.media)\n        .then(setupElement.bind(this, this.canvas));\n}\n\nfunction setupElement(canvas, el){\n    var self = this;\n    this.el = el;\n    return new Promise(function(resolve){\n        fastdom.mutate(function initStim(){\n            // setup element\n            el.classList.add('minno-stimulus');\n            el.setAttribute('data-handle', self.handle); // data-handle for handeling of mouse/touch interactions\n            setSize(el, self.source);\n            setPlace(el, self.source);\n            css(el, self.source.css || {});\n\n            if (self.source.isLayout) el.classList.add('minno-stimulus-visible');\n\n            // append to canvas\n            canvas.appendChild(el);\n            resolve(el);\n        });\n    });\n}\n\nfunction show(){\n    var el = this.el;\n    if (!el) throw new Error('A stimulus can not be shown before init is called');\n\n    fastdom.mutate(function showStim(){\n        el.classList.add('minno-stimulus-visible');\n    });\n}\n\nfunction hide(){\n    var el = this.el;\n    if (!el) throw new Error('A stimulus can not be hidden before init is called');\n\n    fastdom.mutate(function hideStim(){\n        el.classList.remove('minno-stimulus-visible');\n    });\n}\n\nfunction destroy(){\n    var el = this.el;\n    var canvas = this.canvas;\n    fastdom.mutate(function removeStim(){\n        canvas.removeChild(el);\n    });\n}\n\nfunction name(){\n    var source = this.source;\n    // if we have an alias ues it\n    if (source.alias) {return source.alias;}\n    if (this.data.alias) {return this.data.alias;} // if we have an alias ues it\n\n    if (source.inherit && source.inherit.set) {return source.inherit.set;} // otherwise try using the set we inherited from\n    if (this.handle) {return this.handle;} // otherwise use handle\n\n    // if no individual name is given, we set a default at the collection level\n}\n\nfunction mediaName(options){\n    var media = this.source.media;\n    var fullpath = options && options.fullpath; // as set within settings\n\n    if (media.alias) {return media.alias;} // if we have an alias ues it\n\n    for (var prop in media) {\n        if (contains(['image','template'],prop)) return fullpath ? media[prop] : media[prop].replace(/^.*[\\\\/]/, '');\n\n        // sometimes we have an empty value (this happens when we load a template and then translate it into an inline template)\n        if (contains(['word','html','inlineTemplate'],prop) && media[prop]) return media[prop];\n    }\n\n    // if no individual name is given, we set a default at the collection level\n}\n\nfunction contains(arr, val){ return arr.indexOf(val) != -1;}\n","import Stimulus from './Stimulus';\n\nexport default stimCollection;\n\nfunction stimCollection(trial, canvas){\n    var source = trial._source;\n    var stimuli = source.stimuli.map(toStim);\n    var layout = source.layout.map(toLayout).map(toStim);\n    var ready = Promise.all(stimuli.concat(layout).map(function(stim){return stim.init();}));\n    var self = {\n        canvas: canvas,\n        stimuli: stimuli,\n        layout: layout,\n        ready: ready,\n        getStimlist: getStimlist,\n        getMedialist: getMedialist,\n        destroy: destroy\n    };\n\n    return self;\n\n    function toStim(stim){ return Stimulus(stim, trial, canvas); }\n    function toLayout(stim){ stim.isLayout = true; return stim;}\n}\n\nfunction getStimlist(){\n    return this.stimuli\n        .filter(function(stim){return !stim.source.nolog;})\n        .map(function(stim, index){return stim.name() || ('stim' + index);});\n}\n\nfunction getMedialist(options){\n    return this.stimuli\n        .filter(function(stim){return !stim.source.nolog;})\n        .map(function(stim, index){return stim.mediaName(options) || ('media' + index);});\n}\n\nfunction destroy(){\n    this.stimuli.concat(this.layout).forEach(function(stim){stim.destroy();});\n}\n","/*\n * gets a condition array (or a single condition) and evaluates it\n * returns true if all statements are true, false otherwise\n *\n * a single condition looks like this:\n *\n *\tcondition = {\n *\t\ttype : 'begin/inputEquals/inputEqualsTrial/inputEqualsStim/function',\n *\t\tvalue: 'right/trialAttribute/stimAttribute/customFunction',\n *\t\thandle: 'stim handle' (optional in case we're targeting a stimulus)\n *\t}\n *\n */\n\nimport _ from 'lodash';\nimport globalGetter from '../global';\n\nexport default evaluate;\n\n// @TODO This should be done using some sort of mapping function (reduce? for loop?)\n// lets have a uniform API for the evaluation functions.\nfunction evaluate(conditions, inputData, trial){\n    var global = globalGetter();\n    var current = global.current || {};\n\n    if (!conditions) throw new Error('There is an interaction without conditions!!');\n\n    // make sure conditions is an array\n    conditions = Array.isArray(conditions) ? conditions : [conditions];\n\n    // the internal event\n    inputData = inputData || {};\n\n    // assume condition is true\n    var isTrue = true;\n\n    // if this is a begin event, make sure we only run conditions that have begin in them\n    if (inputData.type == 'begin' && conditions.every(function(condition){return condition.type != 'begin';})) return false;\n\n    // try to refute the condition\n    conditions.forEach(function checkCondition(condition){\n        var searchObj;\n        var evaluation = true;\n\n        switch (condition.type){\n            case 'begin':\n                if (inputData.type !== 'begin') {\n                    evaluation = false;\n                }\n                break;\n\n            case 'inputEquals' :\n                // make sure condition.value is an array\n                _.isArray(condition.value) || (condition.value = [condition.value]);\n\n                if (_.indexOf(condition.value,inputData.handle) === -1) {\n                    evaluation = false;\n                }\n                break;\n\n            case 'inputEqualsTrial':\n                if (inputData.handle !== trial.data[condition.property]) {\n                    evaluation = false;\n                }\n                break;\n\n            case 'inputEqualsStim':\n                // create search object\n                searchObj = {};\n                if (condition.handle) searchObj['handle'] = condition.handle;\n                searchObj[condition.property] = inputData.handle;\n\n                // are there stimuli answering this descriptions?\n                if (!hasData(searchObj)) evaluation = false;\n                break;\n\n            case 'trialEquals':\n                if (typeof condition.property == 'undefined' || typeof condition.value == 'undefined'){\n                    throw new Error('trialEquals requires both \"property\" and \"value\" to be defined');\n                }\n                if (condition.value !== trial.data[condition.property]) evaluation = false;\n                break;\n\n            case 'inputEqualsGlobal':\n                if (typeof condition.property == 'undefined'){\n                    throw new Error('inputEqualsGlobal requires \"property\" to be defined');\n                }\n                if (inputData.handle !== global[condition.property]){\n                    evaluation = false;\n                }\n                break;\n\n            case 'globalEquals':\n                if (typeof condition.property == 'undefined' || typeof condition.value == 'undefined'){\n                    throw new Error('globalEquals requires both \"property\" and \"value\" to be defined');\n                }\n                if (condition.value !== global[condition.property]){\n                    evaluation = false;\n                }\n                break;\n\n            case 'globalEqualsTrial':\n                if (typeof condition.globalProp == 'undefined' || typeof condition.trialProp == 'undefined'){\n                    throw new Error('globalEqualsTrial requires both \"globalProp\" and \"trialProp\" to be defined');\n                }\n                if (global[condition.globalProp] !== trial.data[condition.trialProp]) {\n                    evaluation = false;\n                }\n                break;\n\n            case 'globalEqualsStim':\n                if (typeof condition.globalProp == 'undefined' || typeof condition.stimProp == 'undefined'){\n                    throw new Error('globalEqualsStim requires both \"globalProp\" and \"stimProp\" to be defined');\n                }\n\n                // create search object\n                searchObj = {};\n                if (condition.handle){\n                    searchObj['handle'] = condition.handle;\n                }\n                searchObj[condition.stimProp] = global[condition.globalProp];\n\n                // are there stimuli answering this descriptions?\n                if (!hasData(searchObj)) evaluation = false;\n                break;\n\n            case 'inputEqualsCurrent':\n                if (typeof condition.property == 'undefined'){\n                    throw new Error('inputEqualsCurrent requires \"property\" to be defined');\n                }\n                if (inputData.handle !== current[condition.property]){\n                    evaluation = false;\n                }\n                break;\n\n            case 'currentEquals':\n                if (typeof condition.property == 'undefined' || typeof condition.value == 'undefined'){\n                    throw new Error('currentEquals requires both \"property\" and \"value\" to be defined');\n                }\n                if (condition.value !== current[condition.property]){\n                    evaluation = false;\n                }\n                break;\n\n            case 'currentEqualsTrial':\n                if (typeof condition.currentProp == 'undefined' || typeof condition.trialProp == 'undefined'){\n                    throw new Error('currentEqualsTrial requires both \"currentProp\" and \"trialProp\" to be defined');\n                }\n                if (current[condition.currentProp] !== trial.data[condition.trialProp]) evaluation = false;\n                break;\n\n            case 'currentEqualsStim':\n                if (typeof condition.currentProp == 'undefined' || typeof condition.stimProp == 'undefined'){\n                    throw new Error('currentEqualsStim requires both \"currentProp\" and \"stimProp\" to be defined');\n                }\n\n                // create search object\n                searchObj = {};\n                if (condition.handle) searchObj['handle'] = condition.handle;\n                searchObj[condition.stimProp] = current[condition.currentProp];\n\n                // are there stimuli answering this descriptions?\n                if (!hasData(searchObj)) evaluation = false;\n                break;\n\n            case 'function' :\n                if (!condition.value.apply(trial,[condition,inputData, trial])) evaluation = false;\n                break;\n\n            case 'custom':\n                if (!condition.fn.apply(null, [condition, inputData, trial])) evaluation = false;\n                break;\n\n            default:\n                throw new Error('Unknown condition type: ' + condition.type);\n        }\n\n        isTrue = isTrue && (condition.negate ? !evaluation : evaluation);\n    });\n\n    return isTrue;\n\n    function hasData(searchObj){\n        return trial.stimulusCollection.stimuli.some(function(stim){\n            var data = stim.data;\n            for (var key in searchObj) {\n                if (searchObj[key] !== data[key]) return false;\n            }\n            return true;\n        });\n    }\n}\n","/*\n * accepts an array of actions (or a single action)\n * and applies them\n *\n * actions = [\n *\t\t{type:actionName,more:options},\n *\t\t{actionName:options}\n * ]\n * @param actions: single action object or array of action objects\n * @param eventData: eventData object\n * @returns Boolean continueActions: whether this action stops further action activations\n */\n\nimport _ from 'lodash';\nimport actionList from './actionList';\n\nexport default applyActions;\n\nfunction applyActions(actions, eventData, trial){\n    // marks whether this is the final action to take\n    var continueActions = true;\n\n    if (!actions) throw new Error('There is an interaction without actions!!');\n\n    actions = _.isArray(actions) ? actions : [actions];\n\n    _.forEach(actions,function(action){\n        var actionFn = actionList[action.type];\n        if (!actionFn) throw new Error('unknown action: ' + action.type);\n\n        // the only reason to halt action activation is the endTrial command\n        if (action.type === 'endTrial') continueActions = false;\n        actionFn(action, eventData, trial);\n    });\n\n    return continueActions;\n}\n","/*\n* Organizer for the interaction function\n* Allows to subscribe and unsubscribe\n*\n*/\n\nimport evaluate from './evaluate';\nimport activate from './action';\n\nexport default interactions;\n\nfunction interactions(trial){\n    var interactions = trial._source.interactions;\n    var isDebug = trial._source.DEBUG && window.DEBUG;\n\n    return eventMap;\n    function eventMap(input_data){\n        var i, interaction, conditionTrue;\n\n        // TODO: move to input\n        input_data.trialId = trial._id;\n        input_data.trialCounter = trial.counter;\n\n        // eslint-disable-next-line no-console\n        if (isDebug) console.groupCollapsed('Event: ' + (input_data.handle || input_data.type), input_data);\n\n        // use an explicit for loop because we need to be able to break\n        for (i=0; i<interactions.length; i++){\n            interaction = interactions[i];\n            conditionTrue = evaluate(interaction.conditions, input_data, trial);\n\n            // eslint-disable-next-line no-console\n            if (isDebug) console.log(conditionTrue, interaction.conditions);\n\n            // if this action includes endTrial we want to stop evalutation\n            // otherwise we might evaluate using data from the next trial by accident...\n            if (conditionTrue) if ( !activate(interaction.actions, input_data, trial) ) break;\n        }\n\n        // eslint-disable-next-line no-console\n        if (isDebug) console.groupEnd('Event: ' + (input_data.handle || input_data.type));\n\n        return input_data;\n    }\n}\n","import _ from 'lodash';\nimport input from './input/input';\nimport stimulusCollection from './stimulus/stimulusCollection';\nimport interactions from './interactions';\nimport stream from 'mithril-stream';\n\nexport default Trial;\n\nvar gid = 0;\n\n// data is already fully inflated\nfunction Trial(source, canvas, settings){\n    // make sure we have all our stuff :)\n    if (!source.interactions) throw new Error('Interactions not defined');\n\n    this.canvas = canvas;\n    this.settings = settings;\n    this._source = source;\n\n    this.$logs = stream();\n    this.$events = stream();\n    this.$end = this.$events.end;\n\n    // make sure we always have a data container\n    this.data = source.data || {};\n\n    // create a uniqueId for this trial\n    this._id = _.uniqueId('trial_');\n    this.counter = gid++;\n\n    this.input = input(this.$events, this);\n    this.stimulusCollection = stimulusCollection(this, canvas);\n\n    // listen for interactions\n    this.$events.map(interactions(this));\n\n    // the next trial we want to play\n    // by default this is simply the next trial, this can be changed using the goto action\n    // the syntax is [destination, properties]\n    this._next = ['next',{}];\n}\n\n_.extend(Trial.prototype,{\n    start: function(){\n        var trial = this;\n\n        // eslint-disable-next-line no-console\n        if (this._source.DEBUG && window.DEBUG) console.group('Trial: ' + this.counter); \n\n        // wait until all simuli are loaded\n        return trial.stimulusCollection.ready\n            .then(function(){\n\n                // activate input\n                arrayWrap(trial._source.input).forEach(trial.input.add); // add each input\n                trial.input.resetTimer(); // reset the interface timer so that event latencies are relative to now.\n\n                // start running\n                trial.$events({type:'begin',latency:0});\n            });\n    },\n\n    end: function(){\n\n        // eslint-disable-next-line no-console\n        if (this._source.DEBUG && window.DEBUG) console.groupEnd('Trial: ' + this.counter); \n\n        // cancel all listeners\n        this.input.destroy();\n\n        this.$events.end(true);\n        this.$end(true);\n    },\n\n    name: function(){\n        // if we have an alias ues it\n        if (this.alias) { return this.alias; }\n        if (this.data.alias) { return this.data.alias; }\n\n        // otherwise try using the set we inherited from\n        if (_.isString(this._source.inherit)){ return this._source.inherit; }\n        if (_.isPlainObject(this._source.inherit)){\n            return this._source.inherit.set;\n        }\n\n        // we're out of options here\n    }\n});\n\nfunction arrayWrap(arr){\n    if (!arr){return [];}\n    return _.isArray(arr) ? arr : [arr];\n}\n\n","import _ from 'lodash';\nimport globalGetter from '../global';\nimport buildUrl from './buildUrl';\n\nexport default nextTrial;\n\nfunction nextTrial(db, goto){\n    var destination = goto[0], properties = goto[1];\n    var sequence = db.currentSequence;\n    var global = globalGetter();\n    var context = {global: global, current: global.current};\n    var source;\n\n    sequence.go(destination, properties, context);\n    source = sequence.current(context, {skip:['layout','stimuli']});\n\n    if (!source) return {done:true};\n\n    source.stimuli = _.map(source.stimuli || [], buildStim, context);\n    source.layout = _.map(source.layout || [], buildStim, context);\n\n    context.trialData = null;\n\n    return {value:source};\n\n    function buildMedia(stim, prop, context){\n        var val = stim[prop];\n\n        if (_.isUndefined(val)) return false;\n        if (_.isString(val)) val = {word: val};\n\n        val = db.inflate('media', val, context);\n\n        // note that the base url is added to the media object during the sequence preload\n        // if needed, build url\n        if (val.image) val.image = buildUrl(val.image,'image');\n\n        if (val.template){\n            // @TODO: remove dependency on requirejs\n            val.inlineTemplate = requirejs('text!' + buildUrl(val.template, 'template'));\n            val.inlineTemplate = _.template(val.inlineTemplate)(context);\n        }\n\n        stim[prop] = val;\n\n        context.mediaData = null;\n        context.mediaMeta = null;\n    }\n\n    function buildStim(stim){\n        var context = this;\n\n        stim = db.inflate('stimulus', stim, context, {skip:['media','touchMedia']});\n        buildMedia(stim, 'media', context);\n        buildMedia(stim, 'touchMedia', context);\n        context.stimulusData = null;\n        context.stimulusMeta = null;\n        return stim;\n    }\n}\n","export default post;\n\nfunction post(url, data){\n    return new Promise(function(resolve, reject){\n        var request = new XMLHttpRequest();\n        request.open('POST',url, true);\n        request.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\n\n        request.onreadystatechange = function() {\n            if (this.readyState === 4) {\n                if (this.status >= 200 && this.status < 400) resolve(this.responseText);\n                else reject(new Error('Failed posting to: ' + url));\n            }\n        };\n\n        request.send(serialize(data));\n    });\n}\n\nfunction serialize(data) {\n    if (typeof data == 'string') return data;\n    return JSON.stringify(data);\n}\n","import _ from 'lodash';\nimport post from './post';\n\nexport default poster;\n\nfunction poster($logs, settings){\n    var cache = [];\n    var url = settings.url;\n\n    if (!url) return; // if we have no url, we can't log anything anyway\n\n    $logs.map(eachLog);\n    $logs.end.map(finalizefLogs);\n\n    function eachLog(log){\n        cache.push(log);\n        if (!settings.pulse) return;\n        if (cache.length >= settings.pulse) {\n            send(cache);\n            cache.length = 0;\n        }\n    }\n\n    function finalizefLogs(){\n        if (cache.length) send(cache);\n    }\n\n    function send(logs){\n        // build post data\n        var data = {json: JSON.stringify(logs)};\n        var postData = _.assign(data, settings.metaData);\n        var serializedPost = serialize(postData);\n\n        return post(url,serializedPost)\n            .catch(function retry(){ return post(url, serializedPost); })\n            .catch(settings.error || _.noop);\n    }\n\n    function serialize(data){\n        var key, r = [];\n        for (key in data) r.push(encodeURIComponent(key) + '=' + encodeURIComponent(data[key]));\n        return r.join('&').replace(/%20/g, '+');\n    }\n}\n","import _ from 'lodash';\n\nexport default transformLogs;\n\nfunction transformLogs(action,eventData,trial){\n    var global = window.piGlobal;\n    var trialData = trial.data, inputData = eventData, logStack = global().current.logs;\n    var fullpath = _.get(trial, 'settings.logger.fullpath', false);\n\n    var stimList = trial.stimulusCollection.getStimlist();\n    var mediaList = trial.stimulusCollection.getMedialist({fullpath:fullpath});\n\n    return {\n        log_serial : logStack.length,\n        trial_id: trial.counter,\n        name: trial.name(),\n        responseHandle: inputData.handle,\n        latency: Math.floor(inputData.latency),\n        stimuli: stimList,\n        media: mediaList,\n        data: trialData\n    };\n}\n","import poster from './poster';\nimport transformLogs from './transformLogs';\nimport global from '../../global';\n\nexport default createLogs;\n\nfunction createLogs($logs, settings){\n    var $sink = $logs.map(applyMap(settings.logger || settings.transformLogs || transformLogs));\n    $sink.map(function(log){\n        global().current.logs.push(log);\n    });\n\n    poster($sink, settings);\n    if (settings.poster) settings.poster($sink, settings);\n\n    return $sink;\n\n    // $logs is a stream of array, we want to apply them as args to the transform function\n    function applyMap(fn){\n        return function(args){ return fn.apply(null,args); };\n    }\n}\n","import _ from 'lodash';\nimport stream from 'mithril-stream';\nimport fastdom from 'fastdom';\n\nimport Trial from './trial/Trial';\nimport nextTrial from './sequencer/nextTrial';\nimport createLogs from './task/logger/createLogs';\n\nexport default playerPhase;\n\n/**\n * run the task\n * @param canvas : htmlElement\n * @returns sink : {end, promise}\n **/\n\nfunction playerPhase(canvas, db, script){\n    var $source = stream();\n    var $trial = $source.map(activateTrial());\n    var $logs = stream();\n\n    var onDone = _.get(script, 'settings.hooks.endTask', script.settings.onEnd || _.noop);\n\n    $source.end\n        .map(clearCanvas)\n        .map(onDone);\n\n    return {\n        $trial:$trial, \n        end: $source.end,  // TODO:  possibly bind to true?\n        $logs: createLogs($logs, script.settings.logger || {}), \n        play: play // TODO: possibly rename to start\n    };\n\n    function clearCanvas(){\n        var trial = $trial();\n        if (trial) trial.stimulusCollection.destroy();\n    }\n\n    function play(goto){\n        var next = nextTrial(db, goto);\n        if (next.done) $source.end(true);\n        else $source(next.value);\n    }\n\n    function activateTrial(cache){\n        return activate;\n        function activate(source){\n            var oldTrial = cache;\n            var trial = cache = new Trial(source, canvas, script.settings);\n            trial.$logs.map($logs); \n            trial.$end\n                .map(function(){\n                    play(trial._next); // when we're done try to play the next one\n                });\n\n            trial.start();\n\n            if (oldTrial) {\n                // we leave the old stimuli until the current ones are visiblie to maintain the continuity between trials\n                // This mutate waits until the first mutation in order to schedudual the removal of the old stimuli\n                fastdom.mutate(function oldtrial(){\n                    oldTrial.stimulusCollection.destroy();\n                });\n            }\n\n            return trial;\n        }\n    }\n\n}\n","import './utils/polyfills';\n\nimport _ from 'lodash';\n\nimport mainScript from './app/task/script';\nimport global from './app/global';\n\nimport parse from './app/task/parser';\nimport canvasSetup from './app/task/canvasSetup';\nimport preloadPhase from './app/preloadPhase';\nimport playPhase from './app/playPhase';\n\nexport default activate;\n\n/**\n * @TODO: document!!!\n **/\nfunction activate(canvas, script){\n    var $resize = canvasSetup(canvas, script);\n    var db = parse(script); // Build db (can this be pure?) - maybe inject db into playphase\n    var playSink = playPhase(canvas, db, script);\n\n    setupVars(script);\n\n    playSink.end.map(function(){$resize.end(true);}); // end resize stream\n\n    // preload Images, then play \"playPhase\"\n    preloadPhase(canvas, script).then(playSink.play.bind(null, ['next', {}]));\n\n    return playSink;\n}\n\nfunction setupVars(script){\n    // init global\n    var glob = global(global());\n    var name = script.name || 'anonymous minno-time';\n    var current = _.isPlainObject(script.current) ? script.current : {};\n\n    current.logs || (current.logs = []); // init logs object\n    glob[name] = glob.current = current; // create local namespace\n\n    // set the main script as a global\n    mainScript(script);\n}\n","/* eslint-disable */\r\n;(function() {\r\n\"use strict\"\r\n/* eslint-enable */\r\n\r\nvar guid = 0, HALT = {}\r\nfunction createStream() {\r\n\tfunction stream() {\r\n\t\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\r\n\t\treturn stream._state.value\r\n\t}\r\n\tinitStream(stream)\r\n\r\n\tif (arguments.length > 0 && arguments[0] !== HALT) updateStream(stream, arguments[0])\r\n\r\n\treturn stream\r\n}\r\nfunction initStream(stream) {\r\n\tstream.constructor = createStream\r\n\tstream._state = {id: guid++, value: undefined, state: 0, derive: undefined, recover: undefined, deps: {}, parents: [], endStream: undefined, unregister: undefined}\r\n\tstream.map = stream[\"fantasy-land/map\"] = map, stream[\"fantasy-land/ap\"] = ap, stream[\"fantasy-land/of\"] = createStream\r\n\tstream.valueOf = valueOf, stream.toJSON = toJSON, stream.toString = valueOf\r\n\r\n\tObject.defineProperties(stream, {\r\n\t\tend: {get: function() {\r\n\t\t\tif (!stream._state.endStream) {\r\n\t\t\t\tvar endStream = createStream()\r\n\t\t\t\tendStream.map(function(value) {\r\n\t\t\t\t\tif (value === true) {\r\n\t\t\t\t\t\tunregisterStream(stream)\r\n\t\t\t\t\t\tendStream._state.unregister = function(){unregisterStream(endStream)}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn value\r\n\t\t\t\t})\r\n\t\t\t\tstream._state.endStream = endStream\r\n\t\t\t}\r\n\t\t\treturn stream._state.endStream\r\n\t\t}}\r\n\t})\r\n}\r\nfunction updateStream(stream, value) {\r\n\tupdateState(stream, value)\r\n\tfor (var id in stream._state.deps) updateDependency(stream._state.deps[id], false)\r\n\tif (stream._state.unregister != null) stream._state.unregister()\r\n\tfinalize(stream)\r\n}\r\nfunction updateState(stream, value) {\r\n\tstream._state.value = value\r\n\tstream._state.changed = true\r\n\tif (stream._state.state !== 2) stream._state.state = 1\r\n}\r\nfunction updateDependency(stream, mustSync) {\r\n\tvar state = stream._state, parents = state.parents\r\n\tif (parents.length > 0 && parents.every(active) && (mustSync || parents.some(changed))) {\r\n\t\tvar value = stream._state.derive()\r\n\t\tif (value === HALT) return false\r\n\t\tupdateState(stream, value)\r\n\t}\r\n}\r\nfunction finalize(stream) {\r\n\tstream._state.changed = false\r\n\tfor (var id in stream._state.deps) stream._state.deps[id]._state.changed = false\r\n}\r\n\r\nfunction combine(fn, streams) {\r\n\tif (!streams.every(valid)) throw new Error(\"Ensure that each item passed to stream.combine/stream.merge is a stream\")\r\n\treturn initDependency(createStream(), streams, function() {\r\n\t\treturn fn.apply(this, streams.concat([streams.filter(changed)]))\r\n\t})\r\n}\r\n\r\nfunction initDependency(dep, streams, derive) {\r\n\tvar state = dep._state\r\n\tstate.derive = derive\r\n\tstate.parents = streams.filter(notEnded)\r\n\r\n\tregisterDependency(dep, state.parents)\r\n\tupdateDependency(dep, true)\r\n\r\n\treturn dep\r\n}\r\nfunction registerDependency(stream, parents) {\r\n\tfor (var i = 0; i < parents.length; i++) {\r\n\t\tparents[i]._state.deps[stream._state.id] = stream\r\n\t\tregisterDependency(stream, parents[i]._state.parents)\r\n\t}\r\n}\r\nfunction unregisterStream(stream) {\r\n\tfor (var i = 0; i < stream._state.parents.length; i++) {\r\n\t\tvar parent = stream._state.parents[i]\r\n\t\tdelete parent._state.deps[stream._state.id]\r\n\t}\r\n\tfor (var id in stream._state.deps) {\r\n\t\tvar dependent = stream._state.deps[id]\r\n\t\tvar index = dependent._state.parents.indexOf(stream)\r\n\t\tif (index > -1) dependent._state.parents.splice(index, 1)\r\n\t}\r\n\tstream._state.state = 2 //ended\r\n\tstream._state.deps = {}\r\n}\r\n\r\nfunction map(fn) {return combine(function(stream) {return fn(stream())}, [this])}\r\nfunction ap(stream) {return combine(function(s1, s2) {return s1()(s2())}, [stream, this])}\r\nfunction valueOf() {return this._state.value}\r\nfunction toJSON() {return this._state.value != null && typeof this._state.value.toJSON === \"function\" ? this._state.value.toJSON() : this._state.value}\r\n\r\nfunction valid(stream) {return stream._state }\r\nfunction active(stream) {return stream._state.state === 1}\r\nfunction changed(stream) {return stream._state.changed}\r\nfunction notEnded(stream) {return stream._state.state !== 2}\r\n\r\nfunction merge(streams) {\r\n\treturn combine(function() {\r\n\t\treturn streams.map(function(s) {return s()})\r\n\t}, streams)\r\n}\r\n\r\nfunction scan(reducer, seed, stream) {\r\n\tvar newStream = combine(function (s) {\r\n\t\treturn seed = reducer(seed, s._state.value)\r\n\t}, [stream])\r\n\r\n\tif (newStream._state.state === 0) newStream(seed)\r\n\r\n\treturn newStream\r\n}\r\n\r\nfunction scanMerge(tuples, seed) {\r\n\tvar streams = tuples.map(function(tuple) {\r\n\t\tvar stream = tuple[0]\r\n\t\tif (stream._state.state === 0) stream(undefined)\r\n\t\treturn stream\r\n\t})\r\n\r\n\tvar newStream = combine(function() {\r\n\t\tvar changed = arguments[arguments.length - 1]\r\n\r\n\t\tstreams.forEach(function(stream, idx) {\r\n\t\t\tif (changed.indexOf(stream) > -1) {\r\n\t\t\t\tseed = tuples[idx][1](seed, stream._state.value)\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\treturn seed\r\n\t}, streams)\r\n\r\n\treturn newStream\r\n}\r\n\r\ncreateStream[\"fantasy-land/of\"] = createStream\r\ncreateStream.merge = merge\r\ncreateStream.combine = combine\r\ncreateStream.scan = scan\r\ncreateStream.scanMerge = scanMerge\r\ncreateStream.HALT = HALT\r\n\r\nif (typeof module !== \"undefined\") module[\"exports\"] = createStream\r\nelse if (typeof window.m === \"function\" && !(\"stream\" in window.m)) window.m.stream = createStream\r\nelse window.m = {stream : createStream}\r\n\r\n}());\r\n","/*\n * media preloader\n */\n\nexport default loader;\n\nvar srcStack = [];\t\t\t\t// an array holding all our sources\nvar defStack = [];\t\t\t\t// an array holding all the deferreds\nvar stackDone = 0;\t\t\t\t// the number of sources we have completed downloading\nvar images = {};\n\nvar loader = {\n    // loads a single source\n    load: load,\n\n    all: function(){\n        return Promise.all(defStack);\n    },\n\n    getImage: function(url){\n        return images[url].cloneNode();\n    },\n\n    // reset globals so we can reuse this object\n    reset: function(){\n        srcStack = [];\n        defStack = [];\n    },\n\n    progress: function(){\n        return defStack.length ? stackDone/defStack.length : 1;\n    }\n};\n\n// load a single source\nfunction load(src, type){\n    var promise;\n    type = type || 'image';\n    // the source was already loaded\n    if (srcStack.indexOf(src) !== -1) return false;\n\n    // if we haven't loaded this yet\n    switch (type) {\n        case 'template':\n            promise = new Promise(function(resolve, reject){\n                // @TODO: get rid of requirejs dependency\n                requirejs(['text!' + src], resolve, function(){\n                    reject(new Error('Template not found: ' + src));\n                });\n            });\n            break;\n        case 'image':\n            /* falls through */\n        default :\n            promise = new Promise(function(resolve, reject){\n                var el = document.createElement('img');\n                el.onload = function(){resolve(el);};\n                el.onerror = function(){reject(new Error('Image not found: ' + el.src ));};\n                el.src = src;\n                images[src] = el;\n            });\n            break;\n    }\n\n    promise\n        .then(function(){stackDone++;})\n        .then(function(){\n            loader.onload && loader.onload();\n        });\n\n    // keep defered and source for later.\n    defStack.push(promise);\n    srcStack.push(src);\n\n    return promise;\n}\n","!(function(win) {\n\n/**\n * FastDom\n *\n * Eliminates layout thrashing\n * by batching DOM read/write\n * interactions.\n *\n * @author Wilson Page <wilsonpage@me.com>\n * @author Kornel Lesinski <kornel.lesinski@ft.com>\n */\n\n'use strict';\n\n/**\n * Mini logger\n *\n * @return {Function}\n */\nvar debug = 0 ? console.log.bind(console, '[fastdom]') : function() {};\n\n/**\n * Normalized rAF\n *\n * @type {Function}\n */\nvar raf = win.requestAnimationFrame\n  || win.webkitRequestAnimationFrame\n  || win.mozRequestAnimationFrame\n  || win.msRequestAnimationFrame\n  || function(cb) { return setTimeout(cb, 16); };\n\n/**\n * Initialize a `FastDom`.\n *\n * @constructor\n */\nfunction FastDom() {\n  var self = this;\n  self.reads = [];\n  self.writes = [];\n  self.raf = raf.bind(win); // test hook\n  debug('initialized', self);\n}\n\nFastDom.prototype = {\n  constructor: FastDom,\n\n  /**\n   * Adds a job to the read batch and\n   * schedules a new frame if need be.\n   *\n   * @param  {Function} fn\n   * @public\n   */\n  measure: function(fn, ctx) {\n    debug('measure');\n    var task = !ctx ? fn : fn.bind(ctx);\n    this.reads.push(task);\n    scheduleFlush(this);\n    return task;\n  },\n\n  /**\n   * Adds a job to the\n   * write batch and schedules\n   * a new frame if need be.\n   *\n   * @param  {Function} fn\n   * @public\n   */\n  mutate: function(fn, ctx) {\n    debug('mutate');\n    var task = !ctx ? fn : fn.bind(ctx);\n    this.writes.push(task);\n    scheduleFlush(this);\n    return task;\n  },\n\n  /**\n   * Clears a scheduled 'read' or 'write' task.\n   *\n   * @param {Object} task\n   * @return {Boolean} success\n   * @public\n   */\n  clear: function(task) {\n    debug('clear', task);\n    return remove(this.reads, task) || remove(this.writes, task);\n  },\n\n  /**\n   * Extend this FastDom with some\n   * custom functionality.\n   *\n   * Because fastdom must *always* be a\n   * singleton, we're actually extending\n   * the fastdom instance. This means tasks\n   * scheduled by an extension still enter\n   * fastdom's global task queue.\n   *\n   * The 'super' instance can be accessed\n   * from `this.fastdom`.\n   *\n   * @example\n   *\n   * var myFastdom = fastdom.extend({\n   *   initialize: function() {\n   *     // runs on creation\n   *   },\n   *\n   *   // override a method\n   *   measure: function(fn) {\n   *     // do extra stuff ...\n   *\n   *     // then call the original\n   *     return this.fastdom.measure(fn);\n   *   },\n   *\n   *   ...\n   * });\n   *\n   * @param  {Object} props  properties to mixin\n   * @return {FastDom}\n   */\n  extend: function(props) {\n    debug('extend', props);\n    if (typeof props != 'object') throw new Error('expected object');\n\n    var child = Object.create(this);\n    mixin(child, props);\n    child.fastdom = this;\n\n    // run optional creation hook\n    if (child.initialize) child.initialize();\n\n    return child;\n  },\n\n  // override this with a function\n  // to prevent Errors in console\n  // when tasks throw\n  catch: null\n};\n\n/**\n * Schedules a new read/write\n * batch if one isn't pending.\n *\n * @private\n */\nfunction scheduleFlush(fastdom) {\n  if (!fastdom.scheduled) {\n    fastdom.scheduled = true;\n    fastdom.raf(flush.bind(null, fastdom));\n    debug('flush scheduled');\n  }\n}\n\n/**\n * Runs queued `read` and `write` tasks.\n *\n * Errors are caught and thrown by default.\n * If a `.catch` function has been defined\n * it is called instead.\n *\n * @private\n */\nfunction flush(fastdom) {\n  debug('flush');\n\n  var writes = fastdom.writes;\n  var reads = fastdom.reads;\n  var error;\n\n  try {\n    debug('flushing reads', reads.length);\n    runTasks(reads);\n    debug('flushing writes', writes.length);\n    runTasks(writes);\n  } catch (e) { error = e; }\n\n  fastdom.scheduled = false;\n\n  // If the batch errored we may still have tasks queued\n  if (reads.length || writes.length) scheduleFlush(fastdom);\n\n  if (error) {\n    debug('task errored', error.message);\n    if (fastdom.catch) fastdom.catch(error);\n    else throw error;\n  }\n}\n\n/**\n * We run this inside a try catch\n * so that if any jobs error, we\n * are able to recover and continue\n * to flush the batch until it's empty.\n *\n * @private\n */\nfunction runTasks(tasks) {\n  debug('run tasks');\n  var task; while (task = tasks.shift()) task();\n}\n\n/**\n * Remove an item from an Array.\n *\n * @param  {Array} array\n * @param  {*} item\n * @return {Boolean}\n */\nfunction remove(array, item) {\n  var index = array.indexOf(item);\n  return !!~index && !!array.splice(index, 1);\n}\n\n/**\n * Mixin own properties of source\n * object into the target.\n *\n * @param  {Object} target\n * @param  {Object} source\n */\nfunction mixin(target, source) {\n  for (var key in source) {\n    if (source.hasOwnProperty(key)) target[key] = source[key];\n  }\n}\n\n// There should never be more than\n// one instance of `FastDom` in an app\nvar exports = win.fastdom = (win.fastdom || new FastDom()); // jshint ignore:line\n\n// Expose to CJS & AMD\nif ((typeof define) == 'function') define(function() { return exports; });\nelse if ((typeof module) == 'object') module.exports = exports;\n\n})( typeof window !== 'undefined' ? window : this);\n","export default window.performance.now\n    ? window.performance.now.bind(window.performance)\n\n    // We aren't using the absoulte time anywhere so we can use raw Date.now as a replacement\n    // if we're not on IE9\n    : Date.now.bind(Date);\n","import _ from 'lodash';\nimport fastdom from 'fastdom';\nimport global from '../global';\nimport applyCanvasStyles from '../task/applyCanvasStyles';\n\nexport default actions;\n\n// @TODO: see if we can afford to change the signature of actions\n// I'd like to have the trial go first here (used almost always).\nvar actions = {\n    /*\n     * Stimulus actions\n     */\n    showStim: function(action, eventData, trial){\n        var handle = action.handle || action;\n        trial.stimulusCollection.stimuli.forEach(function(stim){\n            if (handle == 'All' || stim.handle == handle) stim.show();\n        });\n    },\n\n    hideStim: function(action, eventData, trial){\n        var handle = action.handle || action;\n        trial.stimulusCollection.stimuli.forEach(function(stim){\n            if (handle == 'All' || stim.handle == handle) stim.hide();\n        });\n    },\n\n    setStimAttr: function(action, eventData, trial){\n        var handle = action.handle;\n        var setter = action.setter;\n        trial.stimulusCollection.stimuli.forEach(function(stim){\n            if (handle == 'All' || stim.handle == handle) {\n                if (_.isFunction(setter)) setter.apply(stim);\n                else _.extend(stim.data, setter);\n            }\n        });\n    },\n\n    /*\n     * Trial actions\n     */\n\n    setTrialAttr: function(action, eventData, trial){\n        var setter = action.setter;\n        if (typeof setter == 'undefined') throw new Error('The setTrialAttr action requires a setter property');\n        if (_.isFunction(setter)) setter.apply(trial, [trial.data,eventData]);\n        else _.extend(trial.data,setter);\n    },\n\n    setInput: function(action, eventData, trial){\n        if (typeof action.input == 'undefined') throw new Error('The setInput action requires an input property');\n        trial.input.add(action.input);\n    },\n\n    trigger: function(action, eventData, trial){\n        if (typeof action.handle == 'undefined') throw new Error('The trigger action requires a handle property');\n        trial.input.add({handle:action.handle, on:'timeout', duration:+action.duration || 0});\n    },\n\n    removeInput: function(action, eventData, trial){\n        var input = trial.input;\n        var handleList = action.handle;\n        if (typeof handleList == 'undefined') throw new Error('The removeInput action requires a handle property');\n        if (handleList == 'All' || _.include(handleList,'All')) input.destroy();\n        else input.remove(handleList);\n    },\n\n    goto: function(action, eventData, trial){\n        trial._next = [action.destination,action.properties];\n    },\n\n    endTrial: function(action, eventData, trial){\n        trial.end();\n    },\n\n    resetTimer: function(action,eventData,trial){\n        // when to reset timer\n        action.immidiate ? reset() :  fastdom.mutate(reset);\n\n        function reset(){\n            eventData.latency = 0;\n            trial.input.resetTimer();\n        }\n    },\n\n    /*\n     * Logger\n     */\n\n    log: function(action,eventData,trial){\n        trial.$logs(arguments);\n    },\n\n    /*\n     * Misc\n     */\n\n    setGlobalAttr: function(action){\n        switch (typeof action.setter){\n            case 'function':\n                action.setter.apply(null,[global(), action]);\n                break;\n            case 'object':\n                _.extend(global(), action.setter);\n                break;\n            default:\n                throw new Error('setGlobalAttr requires a \"setter\" property');\n        }\n    },\n\n    custom: function(action,eventData, trial){\n        if (typeof action.fn != 'function') throw new Error('The custom action requires a fn propery');\n        action.fn(action, eventData, trial);\n    },\n\n    canvas: function(action, eventData, trial){\n        var canvas = trial.cavnas;\n        var map = {\n            background \t\t\t: {element: document.body, property: 'backgroundColor'},\n            canvasBackground\t: {element: canvas, property:'backgroundColor'},\n            borderColor\t\t\t: {element: canvas, property:'borderColor'},\n            borderWidth\t\t\t: {element: canvas, property:'borderWidth'}\n        };\n\n        // settings activator\n        var off = applyCanvasStyles(map, _.pick(action,['background','canvasBackground','borderColor','borderWidth']));\n        trial.$end.map(off);\n    }\n\n};\n\n"],"names":["log","console","apply","arguments","script","obj","scriptObj","global","replace","glob","_","isPlainObject","each","value","key","warn","merge","go","destination","properties","context","mixerSequence","this","where","prev","current","next","Error","direction","sequence","curr","callback","data","parser","db","Database","createColl","add","trialSets","stimulusSets","mediaSets","isArray","currentSequence","getSize","el","computedStyle","window","getComputedStyle","height","parse","offsetHeight","borderTopWidth","borderBottomWidth","width","offsetWidth","borderLeftWidth","borderRightWidth","num","parseFloat","adjust_canvas","canvas","settings","resize","targetSize","getTargetSize","marginTop","style","fontSize","textSize","scrollTo","throttle","event","type","setTimeout","getProportions","proportions","docElement","document","documentElement","maxHeight","clientHeight","maxWidth","Math","min","clientWidth","parentNode","canvasContructor","map","offArr","isUndefined","noop","rule","on","element","property","forEach","fn","call","old","css","str","g","toUpperCase","camelCase","setupCanvas","canvasSettings","get","$resize","stream","classList","adjustCanvas","addEventListener","off","applyCanvasStyles","background","body","canvasBackground","borderColor","borderWidth","pick","end","remove","removeEventListener","settingsGetter","name","buildUrl","url","base_url","isString","isObject","test","length","loadMedia","media","image","preloader","load","template","loadStimulus","stimulus","loadInput","input","loadTrial","trial","layout","stimuli","loadSequence","mixer","loadScript","sequencePreload","reset","preloadPhase","emptyCanvas","firstChild","removeChild","preload","progress","Promise","resolve","then","innerHTML","barStyle","getElementsByClassName","onload","fastdom","mutate","all","src","mouseEvents","eventName","$listener","inputObj","appendChild","e","target","getAttribute","stimHandle","keypressed","keypressListener","keyDownArr","which","indexOf","preventDefault","Array","charCodeAt","keyup","simpleRandomize","floor","random","isFunction","isNumber","max","timeout","timeoutID","duration","randomize","clearTimeout","bind","inputBinder","createElement","css2","css1","assign","position","left","opacity","right","top","bottom","createListener","handle","isStream","binder","_state","interfaceFn","$events","listenerStack","baseTime","trialId","_id","counter","timestamp","Date","latency","now","push","i","listener","splice","destroy","resetTimer","getMedia","html","inlineTemplate","word","textContent","reject","onerror","jquery","setSize","size","font_size","isSet","prop","setPlace","isNumeric","val","isNaN","location","undefined","attr","Stimulus","self","source","init","show","hide","mediaName","set","setupElement","setAttribute","isLayout","alias","inherit","options","fullpath","contains","arr","stimCollection","toStim","stim","_source","ready","concat","getStimlist","getMedialist","filter","nolog","index","evaluate","conditions","inputData","hasData","searchObj","stimulusCollection","some","globalGetter","isTrue","every","condition","evaluation","globalProp","trialProp","stimProp","currentProp","negate","applyActions","actions","eventData","continueActions","action","actionFn","actionList","interactions","isDebug","DEBUG","input_data","interaction","conditionTrue","trialCounter","groupCollapsed","activate","groupEnd","Trial","$logs","$end","uniqueId","gid","_next","arrayWrap","nextTrial","goto","buildMedia","inflate","requirejs","mediaData","mediaMeta","buildStim","skip","stimulusData","stimulusMeta","trialData","done","post","request","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","status","responseText","send","serialize","JSON","stringify","poster","logs","json","serializedPost","metaData","catch","error","r","encodeURIComponent","join","cache","pulse","transformLogs","piGlobal","logStack","stimList","mediaList","log_serial","trial_id","responseHandle","createLogs","$sink","args","applyMap","logger","playerPhase","play","$source","$trial","oldTrial","start","activateTrial","onDone","onEnd","setupVars","mainScript","getTime","group","table","vendors","requestAnimationFrame","vp","cancelAnimationFrame","navigator","userAgent","lastTime","nextTime","PromisePolyfill","executor","handler","list","shouldAbsorb","execute","callAsync","resolvers","rejectors","instance","state","retry","TypeError","executeOnce","rejectCurrent","run","runs","resolveCurrent","_instance","setImmediate","prototype","onFulfilled","onRejection","resolveNext","rejectNext","promise","total","count","values","consume","race","createStream","HALT","updateStream","initStream","constructor","id","guid","derive","recover","deps","parents","endStream","unregister","ap","valueOf","toJSON","toString","Object","defineProperties","unregisterStream","updateState","updateDependency","finalize","changed","mustSync","active","combine","streams","valid","initDependency","dep","notEnded","registerDependency","dependent","s1","s2","s","scan","reducer","seed","newStream","scanMerge","tuples","tuple","idx","module","srcStack","defStack","stackDone","images","loader","getImage","cloneNode","win","FastDom","reads","writes","raf","debug","scheduleFlush","scheduled","flush","runTasks","message","tasks","task","shift","array","item","mixin","hasOwnProperty","webkitRequestAnimationFrame","mozRequestAnimationFrame","msRequestAnimationFrame","cb","measure","ctx","clear","extend","props","child","create","initialize","exports","performance","showStim","hideStim","setStimAttr","setter","setTrialAttr","setInput","trigger","removeInput","handleList","include","endTrial","immidiate","setGlobalAttr","custom","cavnas","canvasSetup","playSink","playPhase"],"mappings":"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"}